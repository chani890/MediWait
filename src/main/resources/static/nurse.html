<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„í˜¸ì‚¬ - ì ‘ìˆ˜ ê´€ë¦¬</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        /* ì•”í˜¸ ì…ë ¥ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .password-modal {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .password-modal h2 {
            margin-bottom: 1rem;
            color: #333;
        }

        .password-input {
            width: 100%;
            padding: 0.8rem;
            margin: 1rem 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            text-align: center;
        }

        .password-input:focus {
            outline: none;
            border-color: #333;
        }

        .password-btn {
            width: 100%;
            padding: 0.8rem;
            background: white;
            color: #333;
            border: 2px solid #333;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .password-btn:hover {
            background: #f8f9fa;
            border-color: #000;
            color: #000;
        }

        .password-error {
            color: #dc3545;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .main-content {
            display: none;
        }

        .header {
            background: white;
            color: black;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-bottom: 2px solid #333;
            padding-bottom: 0.5rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.8rem 1.5rem;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #333;
            border: 2px solid #333;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active:hover {
            background: #f8f9fa;
            border-color: #000;
            color: #000;
        }

        .reception-list {
            display: grid;
            gap: 1rem;
        }

        .reception-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .reception-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .reception-item.pending {
            border-left: 4px solid #ffc107;
        }

        .reception-item.confirmed {
            border-left: 4px solid #28a745;
        }

        .reception-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .patient-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #333;
        }

        .reception-time {
            color: #666;
            font-size: 0.9rem;
        }

        .reception-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .detail-item {
            font-size: 0.9rem;
            color: #666;
        }

        .detail-item strong {
            color: #333;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
            margin-right: 0.5rem;
        }

        .btn-primary {
            background: white;
            color: #333;
            border: 2px solid #333;
        }

        .btn-primary:hover {
            background: #f8f9fa;
            border-color: #000;
            color: #000;
        }

        .btn-success {
            background: white;
            color: #333;
            border: 2px solid #333;
        }

        .btn-success:hover {
            background: #f8f9fa;
            border-color: #000;
            color: #000;
        }

        .btn-secondary {
            background: white;
            color: #666;
            border: 2px solid #666;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
            border-color: #333;
            color: #333;
        }

        /* í†µê³„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .period-btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .period-btn:hover {
            background: #f8f9fa !important;
            color: #000 !important;
            border-color: #000 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .period-btn.active {
            background: white !important;
            color: #333 !important;
            border: 2px solid #333 !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .period-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
            color: #999;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .manual-register {
            background: #e8f4f8;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #333;
        }

        .date-input-group {
            position: relative;
        }

        .quick-date-buttons {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 0.5rem;
            z-index: 10;
            display: none;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .btn-quick-date {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background: #f8f9fa;
            color: #495057;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
            flex: 1;
            min-width: 60px;
        }

        .btn-quick-date:hover {
            background: #333;
            color: white;
        }



        #searchResults {
            margin-top: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
            max-height: 400px;
            overflow-y: auto;
        }

        #searchResults h3 {
            padding: 1rem;
            margin: 0;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            color: #333;
            font-size: 1.1rem;
        }

        #searchResultsList .reception-item {
            margin: 0;
            border: none;
            border-bottom: 1px solid #e9ecef;
            border-radius: 0;
        }

        #searchResultsList .reception-item:last-child {
            border-bottom: none;
        }

        #searchResultsList .reception-item:hover {
            background: #f8f9fa;
        }

        .patient-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .suggestion-item {
            padding: 0.75rem;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background 0.2s;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
        }

        .suggestion-name {
            font-weight: 600;
            color: #333;
        }

        .suggestion-details {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .existing-patient-info {
            margin: 1rem 0;
            padding: 1rem;
            background: #e8f4f8;
            border: 1px solid #b8daff;
            border-radius: 8px;
        }

        .existing-patient-info h4 {
            margin: 0 0 1rem 0;
            color: #333;
            font-size: 1.1rem;
        }

        .patient-info-card {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .patient-basic-info {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .patient-basic-info .patient-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #333;
        }

        .patient-basic-info .patient-birth,
        .patient-basic-info .patient-phone {
            color: #666;
            font-size: 0.9rem;
        }

        .patient-history {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            color: #666;
        }

        .patient-symptoms {
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .form-group {
            position: relative;
        }

        /* ì²˜ë°©ì „ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .prescription-preview {
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px;
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .prescription-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 3px solid #333;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .clinic-info {
            text-align: left;
        }

        .clinic-info h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .clinic-info p {
            color: #666;
            font-size: 0.9em;
            margin: 2px 0;
        }

        .prescription-title {
            text-align: center;
        }

        .prescription-title h1 {
            color: #333;
            font-size: 2.2em;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .prescription-title p {
            color: #666;
            font-size: 1em;
        }

        .patient-info-section {
            margin-bottom: 30px;
        }

        .patient-info-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #333;
        }

        .patient-info-table td {
            padding: 12px 15px;
            border: 1px solid #333;
            font-size: 1em;
        }

        .patient-info-table td:first-child,
        .patient-info-table td:nth-child(3) {
            background: #f8f9fa;
            width: 120px;
            font-weight: 600;
        }

        .prescription-section {
            margin-bottom: 25px;
        }

        .prescription-section h3 {
            color: #333;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #333;
        }

        .prescription-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #333;
        }

        .prescription-table th,
        .prescription-table td {
            padding: 12px 15px;
            border: 1px solid #333;
            text-align: left;
        }

        .prescription-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .prescription-table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        .notes-box,
        .followup-box {
            border: 2px solid #333;
            padding: 15px;
            background: #f8f9fa;
            min-height: 60px;
            border-radius: 4px;
        }

        .prescription-footer {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .doctor-info {
            text-align: left;
        }

        .doctor-info p {
            margin: 5px 0;
            font-size: 1em;
        }

        .prescription-note {
            text-align: right;
            font-size: 0.9em;
            color: #666;
        }

        .prescription-note p {
            margin: 3px 0;
        }

        .print-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }

        .print-actions .btn {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .hidden {
            display: none;
        }

        @media print {
            .print-actions {
                display: none !important;
            }
            
            .prescription-preview {
                border: none;
                box-shadow: none;
                padding: 0;
                margin: 0;
            }
            
            body * {
                visibility: hidden;
            }
            
            .prescription-preview, .prescription-preview * {
                visibility: visible;
            }
            
            .prescription-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.7rem;
            margin-top: 0.8rem;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.8rem;
            background: white;
            border-radius: 6px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 16px;
            gap: 8px;
        }

        .radio-item:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }

        .radio-item input[type="radio"] {
            margin: 0;
            width: 18px;
            height: 18px;
            accent-color: #007bff;
            cursor: pointer;
        }

        .radio-item:has(input[type="radio"]:checked) {
            border-color: #007bff;
            background: #e7f3ff;
        }
    </style>
</head>
<body>
    <!-- ì•”í˜¸ ì…ë ¥ í™”ë©´ -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-modal">
            <h2>ğŸ”’ ê°„í˜¸ì‚¬ í˜ì´ì§€ ì ‘ê·¼</h2>
            <p>ì•”í˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            <input type="password" id="passwordInput" class="password-input" placeholder="ì•”í˜¸ ì…ë ¥" maxlength="20">
            <button onclick="checkPassword()" class="password-btn">í™•ì¸</button>
            <div id="passwordError" class="password-error"></div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-content">
        <div class="header">
            <h1><i class="fas fa-hospital"></i> ì„œëŒ€ ë³‘ì›</h1>
        </div>

        <div class="container">
        <!-- í†µê³„ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="pendingCount">-</div>
                <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="confirmedCount">-</div>
                <div class="stat-label">í™•ì¸ë¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayTotal">-</div>
                <div class="stat-label">ì˜¤ëŠ˜ ì´ ì ‘ìˆ˜</div>
            </div>
        </div>

        <!-- í™˜ì ì ‘ìˆ˜ -->
        <div class="section">
            <h2>ğŸ‘¤ í™˜ì ì ‘ìˆ˜</h2>
            <div class="manual-register">
                <form id="manualRegisterForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manualName">ì´ë¦„ *</label>
                            <input type="text" id="manualName" name="name" required placeholder="í™˜ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <div id="patientSuggestions" class="patient-suggestions"></div>
                        </div>
                        <div class="form-group">
                            <label for="manualBirthDate">ìƒë…„ì›”ì¼ *</label>
                            <input type="text" id="manualBirthDate" name="birthDate" placeholder="YYYY-MM-DD (ì˜ˆ: 1990-01-15)" required 
                                   pattern="^\d{4}-\d{2}-\d{2}$" maxlength="10">
                            <small style="color: #666; font-size: 0.8rem; margin-top: 0.25rem; display: block;">
                                YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1990-01-15)
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="manualPhone">ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" id="manualPhone" name="phoneNumber" placeholder="010-1234-5678">
                        </div>

                    </div>
                    
                    <!-- ê¸°ì¡´ í™˜ì ì •ë³´ í‘œì‹œ ì˜ì—­ -->
                    <div id="existingPatientInfo" class="existing-patient-info" style="display: none;">
                        <h4>ğŸ“‹ ê¸°ì¡´ í™˜ì ì •ë³´</h4>
                        <div class="patient-info-card">
                            <div class="patient-basic-info" id="existingPatientBasicInfo">
                                <span id="existingPatientName" class="patient-name"></span>
                                <span id="existingPatientBirth" class="patient-birth"></span>
                                <span id="existingPatientPhone" class="patient-phone"></span>
                                <button id="editPatientBtn" type="button" class="btn btn-secondary" style="margin-left:1rem; font-size:0.9rem; padding:0.2rem 0.8rem;">ìˆ˜ì •</button>
                            </div>
                            <div class="patient-basic-info" id="editPatientForm" style="display:none; gap:0.5rem; align-items:center;">
                                <input type="text" id="editPatientName" class="patient-name" style="width:120px;" placeholder="ì´ë¦„">
                                <input type="date" id="editPatientBirth" class="patient-birth" style="width:130px;">
                                <input type="text" id="editPatientPhone" class="patient-phone" style="width:140px;" placeholder="ì „í™”ë²ˆí˜¸">
                                <button id="savePatientBtn" type="button" class="btn btn-primary" style="font-size:0.9rem; padding:0.2rem 0.8rem;">ì €ì¥</button>
                                <button id="cancelEditPatientBtn" type="button" class="btn btn-secondary" style="font-size:0.9rem; padding:0.2rem 0.8rem;">ì·¨ì†Œ</button>
                            </div>
                            <div class="patient-history">
                                <div class="visit-count">ì´ ë°©ë¬¸: <span id="existingVisitCount">0</span>íšŒ</div>
                                <div class="last-visit">ìµœê·¼ ë°©ë¬¸: <span id="existingLastVisit">-</span></div>
                            </div>
                            <div id="existingSymptoms" class="patient-symptoms" style="display: none;">
                                <strong>ìµœê·¼ ì¦ìƒ:</strong> <span id="existingSymptomsText"></span>
                            </div>
                        </div>
                    </div>
                                          <div class="form-row">
                        <div class="form-group" id="manualSmsNotifyGroup">
                          <label style="font-weight:600; margin-bottom: 0.5rem;">SMS ì•Œë¦¼</label>
                          <div class="radio-group">
                            <label class="radio-item">
                              <input type="radio" id="manualNotifyYes" name="notifyEnabled" value="true">
                              ì•Œë¦¼ ë°›ê¸°
                            </label>
                            <label class="radio-item">
                              <input type="radio" id="manualNotifyNo" name="notifyEnabled" value="false" checked>
                              ì•Œë¦¼ ë°›ì§€ ì•Šê¸°
                            </label>
                          </div>
                          <span id="manualNotifyInfo" style="color: #888; font-size: 0.95em; margin-top: 0.5em;"></span>
                        </div>
                      </div>
                      
                    
                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="manualSymptoms">ì¦ìƒ ë©”ëª¨</label>
                            <textarea id="manualSymptoms" name="symptoms" rows="3" placeholder="í™˜ìì˜ ì¦ìƒì´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical; font-family: inherit;"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="submit" class="btn btn-primary">ë°”ë¡œ ì ‘ìˆ˜</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Vital Sign ì…ë ¥ -->
        <div class="section">
            <h2><i class="fas fa-thermometer-half"></i> Vital Sign ì…ë ¥</h2>
            <div class="vital-sign-section">
                <div class="patient-selector" style="margin-bottom: 1rem;">
                    <label for="vitalPatientSelect">í™˜ì ì„ íƒ:</label>
                    <select id="vitalPatientSelect" style="padding: 0.5rem; margin-left: 0.5rem; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                        <option value="">í™˜ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                    <button class="btn btn-secondary" onclick="loadConfirmedPatients()" style="margin-left: 0.5rem;">ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div id="vitalSignForm" style="display: none;">
                    <div class="vital-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div class="vital-item">
                            <label for="bodyTemp">ì²´ì˜¨ (â„ƒ)</label>
                            <input type="number" id="bodyTemp" placeholder="36.5" step="0.1" min="35" max="42" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="vital-item">
                            <label for="bloodPressure">í˜ˆì•• (mmHg)</label>
                            <input type="text" id="bloodPressure" placeholder="120/80" pattern="[0-9]+/[0-9]+" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="vital-item">
                            <label for="pulse">ë§¥ë°• (bpm)</label>
                            <input type="number" id="pulse" placeholder="72" min="40" max="200" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                    
                    <div class="symptom-check" style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ì£¼ìš” ì¦ìƒ ì²´í¬:</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="ê¸°ì¹¨"> ê¸°ì¹¨
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="ì½§ë¬¼"> ì½§ë¬¼
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="ë°œì—´"> ë°œì—´
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="ë‘í†µ"> ë‘í†µ
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="ë³µí†µ"> ë³µí†µ
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="ì„¤ì‚¬"> ì„¤ì‚¬
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="êµ¬í† "> êµ¬í† 
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="symptoms" value="ì–´ì§€ëŸ¬ì›€"> ì–´ì§€ëŸ¬ì›€
                            </label>
                        </div>
                        
                        <div class="other-symptoms" style="margin-top: 1rem;">
                            <label for="otherSymptoms" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ê¸°íƒ€ ì¦ìƒ:</label>
                            <textarea id="otherSymptoms" rows="2" placeholder="ìœ„ ì²´í¬ë°•ìŠ¤ì— ì—†ëŠ” ì¦ìƒì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”..." style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical; font-family: inherit;"></textarea>
                        </div>
                    </div>
                    
                    <div class="medical-history" style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ê³¼ê±°ë ¥ ì²´í¬:</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="history" value="ë‹¹ë‡¨"> ë‹¹ë‡¨
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="history" value="ê³ í˜ˆì••"> ê³ í˜ˆì••
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="history" value="ì‹¬ì¥ë³‘"> ì‹¬ì¥ë³‘
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="history" value="ë³µìš©ì•½ ìˆìŒ"> ë³µìš©ì•½ ìˆìŒ
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="history" value="ì•Œë ˆë¥´ê¸°"> ì•Œë ˆë¥´ê¸°
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.3rem;">
                                <input type="checkbox" name="history" value="ì—†ìŒ"> ì—†ìŒ
                            </label>
                        </div>
                    </div>
                    
                    <div class="additional-notes" style="margin-bottom: 1rem;">
                        <label for="nurseNotes" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ê°„í˜¸ì‚¬ ë©”ëª¨:</label>
                        <textarea id="nurseNotes" rows="3" placeholder="ì¶”ê°€ ê´€ì°°ì‚¬í•­ì´ë‚˜ í™˜ì ìƒíƒœë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical; font-family: inherit;"></textarea>
                    </div>
                    
                    <div class="vital-actions">
                        <button class="btn btn-primary" onclick="saveVitalSigns()">Vital Sign ì €ì¥</button>
                        <button class="btn btn-secondary" onclick="clearVitalForm()">ì´ˆê¸°í™”</button>
                    </div>
                </div>
            </div>
        </div>



        <!-- íƒ­ ë©”ë‰´ -->
        <div class="section">
            <div class="tabs">
                <div class="tab active" data-tab="pending">ëŒ€ê¸° ì¤‘ ì ‘ìˆ˜</div>
                <div class="tab" data-tab="confirmed">í™•ì¸ëœ ì ‘ìˆ˜</div>
                <div class="tab" data-tab="prescriptions">ì²˜ë°©ì „ ì¶œë ¥</div>
                <div class="tab" data-tab="statistics">í†µê³„</div>
                <div class="tab" data-tab="sms">ì„¤ì •</div>
            </div>

            <!-- ëŒ€ê¸° ì¤‘ ì ‘ìˆ˜ -->
            <div id="pendingTab" class="tab-content">
                <div id="pendingLoading" class="loading">
                    <div class="spinner"></div>
                    <p>ëŒ€ê¸° ì¤‘ ì ‘ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                <div id="pendingList" class="reception-list"></div>
            </div>

            <!-- í™•ì¸ëœ ì ‘ìˆ˜ -->
            <div id="confirmedTab" class="tab-content" style="display: none;">
                <div id="confirmedLoading" class="loading">
                    <div class="spinner"></div>
                    <p>í™•ì¸ëœ ì ‘ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                <div id="confirmedList" class="reception-list"></div>
            </div>

            <!-- ì²˜ë°©ì „ ì¶œë ¥ -->
            <div id="prescriptionsTab" class="tab-content" style="display: none;">
                <div class="prescription-controls" style="margin-bottom: 1rem;">
                    <button class="btn btn-primary" onclick="loadPendingPrescriptions()">
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                    <span style="margin-left: 1rem; color: #666;">
                        ì¶œë ¥ ëŒ€ê¸° ì¤‘ì¸ ì²˜ë°©ì „: <strong id="pendingPrescriptionCount">0</strong>ê±´
                    </span>
                </div>
                
                <div id="prescriptionLoading" class="loading">
                    <div class="spinner"></div>
                    <p>ì²˜ë°©ì „ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                <div id="prescriptionList" class="reception-list"></div>
            </div>

            <!-- í†µê³„ -->
            <div id="statisticsTab" class="tab-content" style="display: none;">
                <!-- ê¸°ê°„ ì„ íƒ -->
                <div class="statistics-controls" style="margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                    <div class="period-buttons" style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        <button class="btn btn-secondary period-btn active" data-period="today" onclick="loadStatistics('today')">ì˜¤ëŠ˜</button>
                        <button class="btn btn-secondary period-btn" data-period="week" onclick="loadStatistics('week')">ì´ë²ˆ ì£¼</button>
                        <button class="btn btn-secondary period-btn" data-period="month" onclick="loadStatistics('month')">ì´ë²ˆ ë‹¬</button>
                        <button class="btn btn-secondary period-btn" data-period="custom" onclick="showCustomPeriod()">ê¸°ê°„ë³„ í†µê³„</button>
                    </div>
                    
                    <div id="customPeriodDiv" style="display: none;">
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <label>ì‹œì‘ì¼:</label>
                            <input type="date" id="startDate" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                            <label>ì¢…ë£Œì¼:</label>
                            <input type="date" id="endDate" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                            <button class="btn btn-primary" onclick="loadCustomStatistics()">ì¡°íšŒ</button>
                        </div>
                    </div>
                </div>

                <!-- ë¡œë”© -->
                <div id="statisticsLoading" class="loading">
                    <div class="spinner"></div>
                    <p>í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>

                <!-- í†µê³„ ì»¨í…ì¸  -->
                <div id="statisticsContent" style="display: none;">
                    <!-- ê¸°ë³¸ í†µê³„ -->
                    <div class="stats-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div class="stat-number" id="totalVisits">0</div>
                            <div class="stat-label">ì´ ë°©ë¬¸ì ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalNewPatients">0</div>
                            <div class="stat-label">ì‹ ê·œ í™˜ì ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalPrescriptions">0</div>
                            <div class="stat-label">ì²˜ë°©ì „ ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="averageWaitingTime">0</div>
                            <div class="stat-label">í‰ê·  ëŒ€ê¸°ì‹œê°„ (ë¶„)</div>
                        </div>
                    </div>

                    <!-- í”¼í¬ ì‹œê°„ ì •ë³´ -->
                    <div class="peak-info" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div class="stat-number" id="busiestHour" style="font-size: 1.2rem;">-</div>
                            <div class="stat-label">ê°€ì¥ ë°”ìœ ì‹œê°„ëŒ€</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="busiestDay" style="font-size: 1.2rem;">-</div>
                            <div class="stat-label">ê°€ì¥ ë°”ìœ ìš”ì¼</div>
                        </div>
                    </div>

                    <!-- ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ -->
                    <div class="charts-container" style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-start;">
                        <div class="chart-section" style="flex: 1 1 250px; min-width: 220px; max-width: 350px; margin-bottom: 0.7rem;">
                            <h3 style="margin-bottom: 1rem; color: #333;">ì‹œê°„ëŒ€ë³„ ë°©ë¬¸ì ìˆ˜</h3>
                            <div style="background: white; padding: 0.2rem; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                <canvas id="hourlyChart" width="250" height="120"></canvas>
                            </div>
                        </div>
                        <div class="chart-section" style="flex: 1 1 180px; min-width: 160px; max-width: 220px; margin-bottom: 0.7rem;">
                            <h3 style="margin-bottom: 1rem; color: #333;">ìš”ì¼ë³„ ë°©ë¬¸ì ìˆ˜</h3>
                            <div style="background: white; padding: 0.2rem; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                <canvas id="weeklyChart" width="180" height="110"></canvas>
                            </div>
                        </div>
                        <div class="chart-section" style="flex: 1 1 180px; min-width: 160px; max-width: 220px; margin-bottom: 0.7rem;">
                            <h3 style="margin-bottom: 1rem; color: #333;">ì—°ë ¹ëŒ€ë³„ ë°©ë¬¸ì ë¶„í¬</h3>
                            <div style="background: white; padding: 0.2rem; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                <canvas id="ageChart" width="180" height="110"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SMS ê´€ë¦¬ -->
            <div id="smsTab" class="tab-content" style="display: none;">
                <div class="sms-management">
                    <!-- ëŒ€ê¸°ì‹œê°„ ì„¤ì • ì„¹ì…˜ -->
                    <div class="sms-section" style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: #333;">â° í‰ê·  ëŒ€ê¸°ì‹œê°„ ì„¤ì •</h3>
                        <div class="waiting-time-control" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #007bff;">
                            <div class="current-setting" style="margin-bottom: 1rem;">
                                <h4 style="margin-bottom: 0.5rem; color: #333;">í˜„ì¬ ì„¤ì •</h4>
                                <div id="currentWaitingTimeDisplay" style="font-size: 1.2rem; font-weight: bold; color: #007bff;">
                                    1ëª…ë‹¹ 3ë¶„
                                </div>
                            </div>
                            
                            <div class="setting-controls" style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                                <label for="waitingTimePerPerson" style="color: #333; font-weight: 500;">1ëª…ë‹¹ ëŒ€ê¸°ì‹œê°„:</label>
                                <input type="number" id="waitingTimePerPerson" min="1" max="30" value="3" 
                                       style="width: 80px; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                <span style="color: #666;">ë¶„</span>
                                <button id="updateWaitingTimeBtn" class="btn btn-primary" onclick="updateWaitingTime()">
                                    ì„¤ì • ë³€ê²½
                                </button>
                            </div>
                            
                            <div class="preview-examples" style="background: #e3f2fd; padding: 1rem; border-radius: 6px; border: 1px solid #bbdefb;">
                                <h5 style="margin-bottom: 0.5rem; color: #1976d2;">ğŸ’¡ ì˜ˆìƒ ëŒ€ê¸°ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°</h5>
                                <div id="waitingTimePreview" style="line-height: 1.6; color: #1976d2; font-size: 0.9rem;">
                                    <div>â€¢ ëŒ€ê¸° 0ëª…: 0ë¶„</div>
                                    <div>â€¢ ëŒ€ê¸° 1ëª…: 3ë¶„</div>
                                    <div>â€¢ ëŒ€ê¸° 2ëª…: 6ë¶„</div>
                                    <div>â€¢ ëŒ€ê¸° 3ëª…: 9ë¶„</div>
                                    <div>â€¢ ëŒ€ê¸° 5ëª…: 15ë¶„</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SMS ëª¨ë“œ ì„¤ì • ì„¹ì…˜ -->
                    <div class="sms-section" style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: #333;"><i class="fas fa-cog"></i> SMS ë°œì†¡ ëª¨ë“œ ì„¤ì •</h3>
                        <div class="sms-mode-control" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #ff9800;">
                            <div class="mode-status" style="margin-bottom: 1rem;">
                                <h4 style="margin-bottom: 0.5rem; color: #333;">í˜„ì¬ ëª¨ë“œ</h4>
                                <div id="currentModeDisplay" style="font-size: 1.2rem; font-weight: bold; color: #ff9800;">
                                    ë¡œë”© ì¤‘...
                                </div>
                            </div>
                            
                            <div class="mode-controls" style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                                <button id="simulationModeBtn" class="btn btn-warning" onclick="setSmsMode(true)">
                                    <i class="fas fa-wrench"></i> ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ
                                </button>
                                <button id="realModeBtn" class="btn btn-success" onclick="setSmsMode(false)">
                                    <i class="fas fa-mobile-alt"></i> ì‹¤ì œ ë°œì†¡ ëª¨ë“œ
                                </button>
                            </div>
                            
                            <div class="mode-info" style="background: #fff3cd; padding: 1rem; border-radius: 6px; border: 1px solid #ffeaa7;">
                                <h5 style="margin-bottom: 0.5rem; color: #856404;">ğŸ’¡ ëª¨ë“œ ì„¤ëª…</h5>
                                <ul style="margin-left: 1.5rem; line-height: 1.6; color: #856404;">
                                    <li><strong>ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ:</strong> ì‹¤ì œ SMSë¥¼ ë°œì†¡í•˜ì§€ ì•Šê³  ë¡œê·¸ë§Œ ì¶œë ¥í•©ë‹ˆë‹¤. (ë¹„ìš© ì ˆì•½)</li>
                                    <li><strong>ì‹¤ì œ ë°œì†¡ ëª¨ë“œ:</strong> ì‹¤ì œ SMSë¥¼ ë°œì†¡í•©ë‹ˆë‹¤. (ë¹„ìš© ë°œìƒ)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- SMS í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
                    <div class="sms-section" style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: #333;"><i class="fas fa-sms"></i> SMS í…ŒìŠ¤íŠ¸ ë°œì†¡</h3>
                        <div class="sms-test-form" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                            <div class="form-row" style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 1rem; align-items: end;">
                                <div class="form-group">
                                    <label for="testPhoneNumber">ì „í™”ë²ˆí˜¸</label>
                                    <input type="text" id="testPhoneNumber" placeholder="010-1234-5678" 
                                           style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div class="form-group">
                                    <label for="testMessage">ë©”ì‹œì§€</label>
                                    <input type="text" id="testMessage" placeholder="í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                                           style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary" onclick="sendTestSms()">SMS ë°œì†¡</button>
                                </div>
                            </div>
                            <div id="testSmsResult" style="margin-top: 1rem; padding: 0.5rem; border-radius: 4px; display: none;"></div>
                        </div>
                    </div>

                    <!-- SMS ì•Œë¦¼ ì„¤ì • ì •ë³´ -->
                    <div class="sms-section">
                        <h3 style="margin-bottom: 1rem; color: #333;">ğŸ”” ìë™ SMS ì•Œë¦¼ ê·œì¹™</h3>
                        <div class="sms-info" style="background: #e7f3ff; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #2196f3;">
                            <ul style="margin-left: 1.5rem; line-height: 1.6; color: #1976d2;">
                                <li>ëŒ€ê¸° í™˜ìê°€ <strong>ìˆì„ ë•Œ</strong> SMS ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.</li>
                                <li>ì•„ë˜ ì„¤ì •í•œ <strong>ë°œì†¡ ì‹œì </strong>ì— ë”°ë¼ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.</li>
                                <li>í™˜ì ì ‘ìˆ˜ í™•ì¸ ì‹œ ë˜ëŠ” ì˜ì‚¬ í˜¸ì¶œ ì‹œ ìë™ìœ¼ë¡œ ì²´í¬ë©ë‹ˆë‹¤.</li>
                                <li>ì „í™”ë²ˆí˜¸ê°€ ì—†ê±°ë‚˜ ì•Œë¦¼ì„ ê±°ë¶€í•œ í™˜ìëŠ” ì œì™¸ë©ë‹ˆë‹¤.</li>
                                <li>í˜„ì¬ ì„¤ì •ëœ ëª¨ë“œì— ë”°ë¼ ì‹¤ì œ ë°œì†¡ ë˜ëŠ” ì‹œë®¬ë ˆì´ì…˜ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- SMS ì•Œë¦¼ ë°œì†¡ ì‹œì  ì„¤ì • -->
                    <div class="sms-section">
                        <h3 style="margin-bottom: 1rem; color: #333;">ğŸ“± SMS ì•Œë¦¼ ë°œì†¡ ì‹œì  ì„¤ì •</h3>
                        <div class="sms-timing-control" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #28a745;">
                            <div class="current-setting" style="margin-bottom: 1rem;">
                                <h4 style="margin-bottom: 0.5rem; color: #333;">í˜„ì¬ ì„¤ì •</h4>
                                <div id="currentNotifyTimingDisplay" style="font-size: 1.2rem; font-weight: bold; color: #28a745;">
                                    ëŒ€ê¸° ìˆœë²ˆ 2ë²ˆì§¸ì¼ ë•Œ ì•Œë¦¼ ë°œì†¡ (ì•ì— 1ëª…)
                                </div>
                            </div>
                            
                            <div class="setting-controls" style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                                <label for="notifyTiming" style="color: #333; font-weight: 500;">ëŒ€ê¸° ìˆœë²ˆ</label>
                                <select id="notifyTiming" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="1">ë°”ë¡œ ë‹¤ìŒ ì°¨ë¡€ (1ë²ˆì§¸)</option>
                                    <option value="2" selected>ì•ì— 1ëª… ìˆì„ ë•Œ (2ë²ˆì§¸)</option>
                                    <option value="3">ì•ì— 2ëª… ìˆì„ ë•Œ (3ë²ˆì§¸)</option>
                                    <option value="4">ì•ì— 3ëª… ìˆì„ ë•Œ (4ë²ˆì§¸)</option>
                                    <option value="5">ì•ì— 4ëª… ìˆì„ ë•Œ (5ë²ˆì§¸)</option>
                                </select>
                                <span style="color: #666;">ì•Œë¦¼ ë°œì†¡</span>
                                <button id="updateNotifyTimingBtn" class="btn btn-success" onclick="updateNotifyTiming()">
                                    ì„¤ì • ë³€ê²½
                                </button>
                            </div>
                            
                            <div class="timing-info" style="background: #e8f5e8; padding: 1rem; border-radius: 6px; border: 1px solid #c3e6cb;">
                                <h5 style="margin-bottom: 0.5rem; color: #155724;">ğŸ’¡ ì„¤ì • ì•ˆë‚´</h5>
                                <ul style="margin-left: 1.5rem; line-height: 1.6; color: #155724; font-size: 0.9rem;">
                                    <li>í™˜ìê°€ ì ‘ìˆ˜ ì‹œ ì„ íƒí•œ ì•Œë¦¼ ì‹œì ê³¼ ê´€ê³„ì—†ì´, ì´ ì„¤ì •ê°’ì´ ìš°ì„  ì ìš©ë©ë‹ˆë‹¤.</li>
                                    <li>ì˜ˆ: "2ëª… ë‚¨ì•˜ì„ ë•Œ"ë¡œ ì„¤ì •í•˜ë©´, í™˜ìì˜ ì• ëŒ€ê¸°ìê°€ 2ëª…ì¼ ë•Œ ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.</li>
                                    <li>ëŒ€ê¸° ì¸ì›ì´ 3ëª… ì´ìƒì¼ ë•Œë§Œ ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // API URLì„ ë™ì ìœ¼ë¡œ ì„¤ì •
        function getApiBaseUrl() {
            // ì‹¤ì œ ì„œë²„ IPë¡œ ê³ ì •
            return 'http://192.168.70.26:8081/api';
        }
        
        const API_BASE_URL = getApiBaseUrl();
        let currentTab = 'pending';
        
        // WebSocket ì—°ê²° ì„¤ì •
        let stompClient = null;
        let isConnected = false;

        function connectWebSocket() {
            const socket = new SockJS('http://192.168.70.26:8081/ws');
            stompClient = Stomp.over(socket);
            
            stompClient.connect({}, function(frame) {
                console.log('WebSocket ì—°ê²° ì„±ê³µ:', frame);
                isConnected = true;
                
                // ëŒ€ê¸°ì—´ ì—…ë°ì´íŠ¸ êµ¬ë…
                stompClient.subscribe('/topic/waiting-queue', function(message) {
                    const data = JSON.parse(message.body);
                    console.log('ëŒ€ê¸°ì—´ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
                    
                    if (data.type === 'QUEUE_UPDATE') {
                        // ì ‘ìˆ˜ ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨
                        loadData();
                        loadConfirmedPatients();
                    }
                });
                
                // ì²˜ë°©ì „ ì—…ë°ì´íŠ¸ êµ¬ë…
                stompClient.subscribe('/topic/prescription-update', function(message) {
                    const data = JSON.parse(message.body);
                    console.log('ì²˜ë°©ì „ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
                    
                    if (data.type === 'PRESCRIPTION_UPDATE') {
                        // ì²˜ë°©ì „ ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨
                        loadPendingPrescriptions();
                    }
                });
                
            }, function(error) {
                console.error('WebSocket ì—°ê²° ì‹¤íŒ¨:', error);
                isConnected = false;
                
                // ì¬ì—°ê²° ì‹œë„
                setTimeout(() => {
                    console.log('WebSocket ì¬ì—°ê²° ì‹œë„...');
                    connectWebSocket();
                }, 5000);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            checkPassword();
            loadData();
            connectWebSocket();
            loadNotifyTimingSettings();
            
            // í™˜ì ì ‘ìˆ˜ í¼ ì´ˆê¸°í™” (ëŒ€ê¸° ì¸ì›ì— ë”°ë¥¸ SMS ì•Œë¦¼ ì„¤ì •)
            openGeneralRegisterForm();
            
            // íƒ­ ì „í™˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
            
            // ìˆ˜ê¸° ì ‘ìˆ˜ í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('manualRegisterForm').addEventListener('submit', handleManualRegister);
            
            // í™˜ì ì´ë¦„ ì…ë ¥ ì‹œ ìë™ì™„ì„± ê¸°ëŠ¥
            document.getElementById('manualName').addEventListener('input', function() {
                const name = this.value.trim();
                if (name.length >= 2) {
                    searchPatientByName(name);
                } else {
                    document.getElementById('patientSuggestions').style.display = 'none';
                    clearExistingPatientInfo();
                }
            });
            
            // í™˜ì ì´ë¦„ ì…ë ¥ í•„ë“œì—ì„œ í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ì œì•ˆ ëª©ë¡ ìˆ¨ê¸°ê¸° (ì•½ê°„ì˜ ì§€ì—° í›„)
            document.getElementById('manualName').addEventListener('blur', function() {
                setTimeout(() => {
                    document.getElementById('patientSuggestions').style.display = 'none';
                }, 200);
            });
            
            // ì •ê¸°ì ìœ¼ë¡œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (30ì´ˆë§ˆë‹¤)
            setInterval(() => {
                if (currentTab === 'pending') {
                    loadPendingReceptions();
                } else if (currentTab === 'confirmed') {
                    loadConfirmedReceptions();
                } else if (currentTab === 'prescriptions') {
                    loadPendingPrescriptions();
                }
            }, 30000);
        });

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // íƒ­ ì»¨í…ì¸  í‘œì‹œ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`${tabName}Tab`).style.display = 'block';

            currentTab = tabName;
            
            // ê° íƒ­ë³„ ì´ˆê¸° ë¡œë“œ
            if (tabName === 'statistics') {
                loadStatistics('today');
            } else if (tabName === 'sms') {
                loadSmsMode();
                loadWaitingTimeSettings();
                loadNotifyTimingSettings();
            }
        }

        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            loadStats();
            loadPendingReceptions();
            loadConfirmedReceptions();
            loadPendingPrescriptions();
        }

        // í†µê³„ ë¡œë“œ
        function loadStats() {
            fetch(`${API_BASE_URL}/statistics/today`)
                .then(response => response.json())
                .then(stats => {
                    document.getElementById('todayTotal').textContent = stats.totalReceptions;
                })
                .catch(error => {
                    console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                });
        }

        // ëŒ€ê¸° ì¤‘ ì ‘ìˆ˜ ë¡œë“œ
        function loadPendingReceptions() {
            fetch(`${API_BASE_URL}/nurse/pending`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(receptions => {
                    // ë°°ì—´ì¸ì§€ í™•ì¸
                    if (!Array.isArray(receptions)) {
                        console.error('ì‘ë‹µì´ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', receptions);
                        receptions = [];
                    }
                    document.getElementById('pendingCount').textContent = receptions.length;
                    renderReceptions('pending', receptions);
                })
                .catch(error => {
                    console.error('ëŒ€ê¸° ì¤‘ ì ‘ìˆ˜ ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('pendingList').innerHTML = '<div class="empty-state"><h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3><p>' + error.message + '</p></div>';
                    document.getElementById('pendingCount').textContent = '0';
                })
                .finally(() => {
                    document.getElementById('pendingLoading').style.display = 'none';
                });
        }

        // í™•ì¸ëœ ì ‘ìˆ˜ ë¡œë“œ
        function loadConfirmedReceptions() {
            fetch(`${API_BASE_URL}/nurse/confirmed`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(receptions => {
                    // ë°°ì—´ì¸ì§€ í™•ì¸
                    if (!Array.isArray(receptions)) {
                        console.error('ì‘ë‹µì´ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', receptions);
                        receptions = [];
                    }
                    document.getElementById('confirmedCount').textContent = receptions.length;
                    renderReceptions('confirmed', receptions);
                })
                .catch(error => {
                    console.error('í™•ì¸ëœ ì ‘ìˆ˜ ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('confirmedList').innerHTML = '<div class="empty-state"><h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3><p>' + error.message + '</p></div>';
                    document.getElementById('confirmedCount').textContent = '0';
                })
                .finally(() => {
                    document.getElementById('confirmedLoading').style.display = 'none';
                });
        }

        // ì ‘ìˆ˜ ëª©ë¡ ë Œë”ë§
        function renderReceptions(type, receptions) {
            const container = document.getElementById(`${type}List`);
            
            // ì•ˆì „ì„± ê²€ì‚¬
            if (!Array.isArray(receptions)) {
                console.error('renderReceptions: receptionsê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', receptions);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>âš ï¸ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜</h3>
                        <p>ì„œë²„ì—ì„œ ì˜ëª»ëœ í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            if (receptions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>ğŸ“‹ ${type === 'pending' ? 'ëŒ€ê¸° ì¤‘ì¸' : 'í™•ì¸ëœ'} ì ‘ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>${type === 'pending' ? 'ìƒˆë¡œìš´ ì ‘ìˆ˜ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.' : 'ëª¨ë“  ì ‘ìˆ˜ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = receptions.map(reception => `
                <div class="reception-item ${type}">
                    <div class="reception-header">
                        <div class="patient-name">${reception.patientName}</div>
                        <div class="reception-time">${formatDateTime(reception.createdAt)}</div>
                    </div>
                    <div class="reception-details">
                        <div class="detail-item">
                            <strong>ì „í™”ë²ˆí˜¸:</strong> ${reception.phoneNumber || 'ì—†ìŒ'}
                        </div>
                        <div class="detail-item">
                            <strong>ì ‘ìˆ˜ì:</strong> ${reception.isGuardian ? 'ë³´í˜¸ì' : 'ë³¸ì¸'}
                        </div>

                        <div class="detail-item">
                            <strong>ìƒíƒœ:</strong> <span class="status-badge status-${type}">${getStatusText(reception.status)}</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        ${type === 'pending' ? `
                            <button class="btn btn-success" onclick="confirmReception(${reception.id})" style="margin-right: 0.5rem;">
                                âœ“ ì‹ ë¶„ì¦ í™•ì¸
                            </button>
                            <button class="btn btn-danger" onclick="deleteReception(${reception.id}, '${reception.patientName}')" style="font-size: 0.8rem;">
                                ğŸ—‘ï¸ ì‚­ì œ
                            </button>
                        ` : `
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label style="font-size: 0.9rem; margin: 0;">
                                    <input type="checkbox" ${reception.smsNotificationEnabled ? 'checked' : ''} 
                                           onchange="toggleSmsNotification(${reception.id}, this.checked)" 
                                           style="margin-right: 0.3rem;">
                                    SMS ì•Œë¦¼
                                </label>
                            <button class="btn btn-danger" onclick="deleteReception(${reception.id}, '${reception.patientName}')" style="font-size: 0.8rem;">
                                ğŸ—‘ï¸ ì‚­ì œ
                            </button>
                            </div>
                        `}
                    </div>
                </div>
            `).join('');
        }

        // ì ‘ìˆ˜ í™•ì¸
        function confirmReception(receptionId) {
            if (!confirm('ì‹ ë¶„ì¦ì„ í™•ì¸í•˜ì…¨ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            fetch(`${API_BASE_URL}/nurse/confirm/${receptionId}`, {
                method: 'POST'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('ì ‘ìˆ˜ í™•ì¸ ì‹¤íŒ¨');
                }
                return response.json();
            })
            .then(result => {
                alert('ì ‘ìˆ˜ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadData(); // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            })
            .catch(error => {
                console.error('ì ‘ìˆ˜ í™•ì¸ ì‹¤íŒ¨:', error);
                alert('ì ‘ìˆ˜ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // SMS ì•Œë¦¼ ì„¤ì • í† ê¸€
        function toggleSmsNotification(receptionId, enabled) {
            fetch(`${API_BASE_URL}/nurse/reception/${receptionId}/sms`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ enabled: enabled })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('SMS ì„¤ì • ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                }
                return response.json();
            })
            .then(result => {
                console.log('SMS ì„¤ì • ì—…ë°ì´íŠ¸ ì„±ê³µ:', result);
                // ì„±ê³µ ì‹œ íŠ¹ë³„í•œ ì•Œë¦¼ ì—†ì´ ì¡°ìš©íˆ ì²˜ë¦¬
            })
            .catch(error => {
                console.error('SMS ì„¤ì • ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                alert('SMS ì„¤ì • ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                // ì‹¤íŒ¨ ì‹œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë˜ëŒë¦¬ê¸°
                event.target.checked = !enabled;
            });
        }

        // ìˆ˜ê¸° ì ‘ìˆ˜ ì²˜ë¦¬
        function handleManualRegister(e) {
            e.preventDefault();
            
            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            const name = document.getElementById('manualName').value;
            const birthDate = document.getElementById('manualBirthDate').value;
            
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!birthDate) {
                alert('ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ìƒë…„ì›”ì¼ í˜•ì‹ ê²€ì¦
            const datePattern = /^\d{4}-\d{2}-\d{2}$/;
            if (!datePattern.test(birthDate)) {
                alert('ìƒë…„ì›”ì¼ì„ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 1990-01-15)');
                return;
            }
            
            // ë‚ ì§œ ìœ íš¨ì„± ê²€ì¦
            const dateObj = new Date(birthDate);
            const today = new Date();
            if (dateObj > today) {
                alert('ìƒë…„ì›”ì¼ì€ ì˜¤ëŠ˜ ë‚ ì§œë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (dateObj < new Date('1900-01-01')) {
                alert('ìƒë…„ì›”ì¼ì´ ë„ˆë¬´ ì˜¤ë˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const phoneNumber = document.getElementById('manualPhone').value;
            const notifyEnabled = document.getElementById('manualNotifyYes').checked;
            const symptoms = document.getElementById('manualSymptoms').value;
            
            // ê°„í˜¸ì‚¬ ì„¤ì •ì—ì„œ notifyAt ê°’ ê°€ì ¸ì˜¤ê¸°
            const savedTiming = localStorage.getItem('notifyTiming');
            const notifyAt = notifyEnabled ? (savedTiming ? parseInt(savedTiming) : 2) : null;
            
            const data = {
                name: name,
                birthDate: birthDate,
                phoneNumber: phoneNumber || null,
                isGuardian: false, // ë™ë„¤ ë³‘ì› íŠ¹ì„±ìƒ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³¸ì¸ ì„¤ì •
                notifyEnabled: notifyEnabled,
                notifyAt: notifyAt,
                symptoms: symptoms || null
            };

            console.log('ìˆ˜ê¸° ì ‘ìˆ˜ ë°ì´í„°:', data); // ë””ë²„ê¹…ìš©

            fetch(`${API_BASE_URL}/nurse/manual-register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(`ìˆ˜ê¸° ì ‘ìˆ˜ ì‹¤íŒ¨: ${text}`);
                    });
                }
                return response.json();
            })
            .then(result => {
                alert(`ìˆ˜ê¸° ì ‘ìˆ˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì ‘ìˆ˜ ë²ˆí˜¸: ${result.id}`);
                // í¼ ë¦¬ì…‹
                document.getElementById('manualName').value = '';
                document.getElementById('manualBirthDate').value = '';
                document.getElementById('manualPhone').value = '';
                document.getElementById('manualSymptoms').value = '';
                // SMS ì•Œë¦¼ ì„¤ì • ì´ˆê¸°í™”
                document.getElementById('manualNotifyYes').checked = false;
                document.getElementById('manualNotifyNo').checked = true;
                clearExistingPatientInfo();
                currentSelectedPatient = null;
                loadData(); // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            })
            .catch(error => {
                console.error('ìˆ˜ê¸° ì ‘ìˆ˜ ì‹¤íŒ¨:', error);
                alert('ìˆ˜ê¸° ì ‘ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            });
        }

        // ì ‘ìˆ˜ ì‚­ì œ
        function deleteReception(receptionId, patientName) {
            const confirmation = confirm(`ì •ë§ë¡œ ì´ ì ‘ìˆ˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní™˜ìëª…: ${patientName}\nì ‘ìˆ˜ ID: ${receptionId}\n\nâš ï¸ ì‚­ì œëœ ì ‘ìˆ˜ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            
            if (!confirmation) {
                return;
            }
            
            console.log('ì ‘ìˆ˜ ì‚­ì œ ìš”ì²­:', { receptionId, patientName });
            
            fetch(`${API_BASE_URL}/nurse/reception/${receptionId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        let errorMessage = 'ì ‘ìˆ˜ ì‚­ì œ ì‹¤íŒ¨';
                        try {
                            const errorData = JSON.parse(text);
                            errorMessage = errorData.message || errorMessage;
                        } catch (e) {
                            if (text) {
                                errorMessage = text;
                            }
                        }
                        throw new Error(`HTTP ${response.status}: ${errorMessage}`);
                    });
                }
                return response.json();
            })
            .then(result => {
                console.log('ì ‘ìˆ˜ ì‚­ì œ ì„±ê³µ:', result);
                alert(`ì ‘ìˆ˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\ní™˜ìëª…: ${patientName}`);
                
                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                loadData();
                loadConfirmedPatients(); // Vital Signìš© í™˜ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            })
            .catch(error => {
                console.error('ì ‘ìˆ˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ì ‘ìˆ˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            });
        }



        // ë‚ ì§œ/ì‹œê°„ í¬ë§·íŒ…
        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleString('ko-KR', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ë‚ ì§œë§Œ í¬ë§·íŒ… (ì²˜ë°©ì „ìš©)
        function formatDate(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getStatusText(status) {
            const statusMap = {
                'PENDING': 'ëŒ€ê¸° ì¤‘',
                'CONFIRMED': 'í™•ì¸ë¨',
                'CALLED': 'í˜¸ì¶œë¨',
                'DONE': 'ì™„ë£Œ',
                'NO_RESPONSE': 'ë¯¸ì‘ë‹µ',
                'CANCELED': 'ì·¨ì†Œë¨'
            };
            return statusMap[status] || status;
        }

        // ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ…
        document.getElementById('manualPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 3 && value.length <= 7) {
                value = value.replace(/(\d{3})(\d{1,4})/, '$1-$2');
            } else if (value.length >= 8) {
                value = value.replace(/(\d{3})(\d{4})(\d{1,4})/, '$1-$2-$3');
            }
            e.target.value = value;
        });

        // ìƒë…„ì›”ì¼ ì…ë ¥ ìë™ í¬ë§·íŒ…
        document.getElementById('manualBirthDate').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            // ìë™ìœ¼ë¡œ í•˜ì´í”ˆ ì¶”ê°€
            if (value.length >= 4) {
                value = value.substring(0, 4) + '-' + value.substring(4);
            }
            if (value.length >= 7) {
                value = value.substring(0, 7) + '-' + value.substring(7, 9);
            }
            
            e.target.value = value;
        });

        // ì´ë¦„ ì…ë ¥ ì‹œ í™˜ì ìë™ ì™„ì„±
        let currentSelectedPatient = null;
        
        function handleNameInput(event) {
            const name = event.target.value.trim();
            const suggestions = document.getElementById('patientSuggestions');
            
            if (name.length < 2) {
                suggestions.style.display = 'none';
                clearExistingPatientInfo();
                return;
            }
            
            // í™˜ì ê²€ìƒ‰
            fetch(`${API_BASE_URL}/nurse/search-patient?name=${encodeURIComponent(name)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ê²€ìƒ‰ ì‹¤íŒ¨');
                    }
                    return response.json();
                })
                .then(patients => {
                    if (patients.length === 0) {
                        suggestions.style.display = 'none';
                        clearExistingPatientInfo();
                    } else {
                        showPatientSuggestions(patients);
                    }
                })
                .catch(error => {
                    console.error('í™˜ì ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                    suggestions.style.display = 'none';
                    clearExistingPatientInfo();
                });
        }
        
        function showPatientSuggestions(patients) {
            const suggestions = document.getElementById('patientSuggestions');
            
            suggestions.innerHTML = patients.map(patient => `
                <div class="suggestion-item" onclick="selectExistingPatient(${patient.patientId})">
                    <div class="suggestion-name">${patient.name}</div>
                    <div class="suggestion-details">
                        ${patient.birthDate} | ${patient.phoneNumber || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ'} | ë°©ë¬¸ ${patient.totalVisits}íšŒ
                        ${patient.lastVisit ? ` | ìµœê·¼: ${formatDateTime(patient.lastVisit)}` : ''}
                    </div>
                </div>
            `).join('');
            
            suggestions.style.display = 'block';
        }
        
        function selectExistingPatient(patientId) {
            // í˜„ì¬ ê²€ìƒ‰ëœ í™˜ì ëª©ë¡ì—ì„œ ì„ íƒëœ í™˜ì ì°¾ê¸°
            const name = document.getElementById('manualName').value;
            
            fetch(`${API_BASE_URL}/nurse/search-patient?name=${encodeURIComponent(name)}`)
                .then(response => response.json())
                .then(patients => {
                    const patient = patients.find(p => p.patientId === patientId);
                    if (patient) {
                        currentSelectedPatient = patient;
                        
                        // í¼ì— ì •ë³´ ìë™ ì…ë ¥
                        document.getElementById('manualName').value = patient.name;
                        document.getElementById('manualBirthDate').value = patient.birthDate;
                        document.getElementById('manualPhone').value = patient.phoneNumber || '';
                        
                        // ê¸°ì¡´ í™˜ì ì •ë³´ í‘œì‹œ
                        showExistingPatientInfo(patient);
                        
                        // ì œì•ˆ ëª©ë¡ ìˆ¨ê¸°ê¸°
                        document.getElementById('patientSuggestions').style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('í™˜ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                });
        }
        
        function showExistingPatientInfo(patient) {
            currentSelectedPatient = patient;
            document.getElementById('existingPatientName').textContent = patient.name;
            document.getElementById('existingPatientBirth').textContent = patient.birthDate;
            document.getElementById('existingPatientPhone').textContent = patient.phoneNumber || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ';
            document.getElementById('existingVisitCount').textContent = patient.totalVisits;
            document.getElementById('existingLastVisit').textContent = patient.lastVisit ? formatDateTime(patient.lastVisit) : 'ì—†ìŒ';
            
            // ìµœê·¼ ì¦ìƒ í‘œì‹œ
            if (patient.latestSurvey && patient.latestSurvey.symptoms) {
                document.getElementById('existingSymptomsText').textContent = patient.latestSurvey.symptoms;
                document.getElementById('existingSymptoms').style.display = 'block';
            } else {
                document.getElementById('existingSymptoms').style.display = 'none';
            }
            
            document.getElementById('existingPatientInfo').style.display = 'block';
            document.getElementById('existingPatientBasicInfo').style.display = 'flex';
            document.getElementById('editPatientForm').style.display = 'none';
        }
        
        function clearExistingPatientInfo() {
            currentSelectedPatient = null;
            document.getElementById('existingPatientInfo').style.display = 'none';
        }
        
        function searchPatientByName(name) {
            if (name.length < 2) {
                document.getElementById('patientSuggestions').style.display = 'none';
                clearExistingPatientInfo();
                return;
            }
            
            fetch(`${API_BASE_URL}/nurse/search-patient?name=${encodeURIComponent(name)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('í™˜ì ê²€ìƒ‰ ì‹¤íŒ¨');
                    }
                    return response.json();
                })
                .then(patients => {
                    if (patients && patients.length > 0) {
                        showPatientSuggestions(patients);
                    } else {
                        document.getElementById('patientSuggestions').style.display = 'none';
                        clearExistingPatientInfo();
                    }
                })
                .catch(error => {
                    console.error('í™˜ì ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                    document.getElementById('patientSuggestions').style.display = 'none';
                    clearExistingPatientInfo();
                });
        }

        // ì²˜ë°©ì „ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadPendingPrescriptions() {
            document.getElementById('prescriptionLoading').style.display = 'block';
            
            fetch(`${API_BASE_URL}/nurse/prescriptions/pending`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(prescriptions => {
                    document.getElementById('pendingPrescriptionCount').textContent = prescriptions.length;
                    renderPrescriptions(prescriptions);
                })
                .catch(error => {
                    console.error('ì²˜ë°©ì „ ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('prescriptionList').innerHTML = '<div class="empty-state"><h3>ì²˜ë°©ì „ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3><p>' + error.message + '</p></div>';
                    document.getElementById('pendingPrescriptionCount').textContent = '0';
                })
                .finally(() => {
                    document.getElementById('prescriptionLoading').style.display = 'none';
                });
        }

        function renderPrescriptions(prescriptions) {
            const container = document.getElementById('prescriptionList');
            
            if (prescriptions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>ì¶œë ¥ ëŒ€ê¸° ì¤‘ì¸ ì²˜ë°©ì „ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ëª¨ë“  ì²˜ë°©ì „ì´ ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = prescriptions.map(prescription => `
                <div class="reception-item prescription-item" style="border-left: 4px solid #17a2b8;">
                    <div class="reception-header">
                        <div class="patient-name">${prescription.patientName}</div>
                        <div class="reception-time">${formatDateTime(prescription.createdAt)}</div>
                    </div>
                    <div class="reception-details">
                        <div class="detail-item">
                            <strong>ìƒë…„ì›”ì¼:</strong> ${prescription.patientBirthDate}
                        </div>
                        <div class="detail-item">
                            <strong>ì§„ë‹¨ëª…:</strong> ${prescription.diagnosis ? prescription.diagnosis.replace(/\n/g, ', ') : '-'}
                        </div>
                        <div class="detail-item">
                            <strong>ì¦ìƒ:</strong> ${prescription.symptoms || '-'}
                        </div>
                        <div class="detail-item">
                            <strong>ì²˜ë°© ì•½ë¬¼:</strong> ${prescription.medications ? prescription.medications.substring(0, 50) + (prescription.medications.length > 50 ? '...' : '') : '-'}
                        </div>
                        <div class="detail-item">
                            <strong>ì˜ì‚¬ ì†Œê²¬:</strong> ${prescription.notes || '-'}
                        </div>
                        <div class="detail-item">
                            <strong>ì¬ì§„ ë‚ ì§œ:</strong> ${prescription.followUpDate ? new Date(prescription.followUpDate).toLocaleString('ko-KR') : '-'}
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary" onclick="viewPrescriptionDetail(${prescription.id})">
                            <i class="fas fa-eye"></i> ìƒì„¸ë³´ê¸°
                        </button>
                        <button class="btn btn-info" onclick="printPrescriptionBrowser(${prescription.id})">
                            <i class="fas fa-print"></i> í”„ë¦°íŠ¸
                        </button>
                        <button class="btn btn-success" onclick="printPrescription(${prescription.id})">
                            <i class="fas fa-check"></i> ì¶œë ¥ì™„ë£Œ
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function viewPrescriptionDetail(prescriptionId) {
            // ì²˜ë°©ì „ ìƒì„¸ ì •ë³´ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œ
            fetch(`${API_BASE_URL}/doctor/prescriptions/${prescriptionId}`)
                .then(response => response.json())
                .then(prescription => {
                    // ì•½ë¬¼ ì •ë³´ íŒŒì‹± (ì˜ì‚¬ í˜ì´ì§€ í˜•ì‹ì— ë§ì¶¤)
                    const medications = prescription.medications ? prescription.medications.split('\n').filter(med => med.trim()) : [];
                    const medicationRows = medications.map(med => {
                        // ì•½ë¬¼ ì •ë³´ë¥¼ ë” ìƒì„¸í•˜ê²Œ íŒŒì‹±
                        let name = '';
                        let dosage = '';
                        let frequency = '';
                        let days = '';
                        let instructions = '';
                        let coverage = '';
                        
                        // ì˜ˆì‹œ: "íƒ€ì´ë ˆë†€ 500mg - 1ì¼ 3íšŒ, 3ì¼ë¶„, ì‹í›„ 30ë¶„ (ê¸‰ì—¬)"
                        const parts = med.split(' - ');
                        if (parts.length >= 1) {
                            name = parts[0].trim();
                        }
                        if (parts.length >= 2) {
                            const detailParts = parts[1].split(',');
                            detailParts.forEach(part => {
                                const trimmed = part.trim();
                                if (trimmed.includes('ì¼ ') && trimmed.includes('íšŒ')) {
                                    frequency = trimmed;
                                } else if (trimmed.includes('ì¼ë¶„')) {
                                    days = trimmed;
                                } else if (trimmed.includes('ì‹') || trimmed.includes('ì·¨ì¹¨') || trimmed.includes('ì•„ì¹¨') || trimmed.includes('ì €ë…')) {
                                    instructions = trimmed;
                                } else if (trimmed.includes('ê¸‰ì—¬') || trimmed.includes('ë¹„ê¸‰ì—¬')) {
                                    coverage = trimmed.replace(/[()]/g, '');
                                } else if (!frequency && !days && !instructions) {
                                    // ì²« ë²ˆì§¸ í•­ëª©ì´ ìš©ëŸ‰ì¼ ê°€ëŠ¥ì„±
                                    if (trimmed.includes('mg') || trimmed.includes('g') || trimmed.includes('ml')) {
                                        dosage = trimmed;
                                    } else {
                                        frequency = trimmed;
                                    }
                                }
                            });
                        }
                        
                        // ìš©ëŸ‰ì´ ì´ë¦„ì— í¬í•¨ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ
                        if (!dosage && name.includes('mg')) {
                            const nameParts = name.split(' ');
                            const dosagePart = nameParts.find(part => part.includes('mg') || part.includes('g') || part.includes('ml'));
                            if (dosagePart) {
                                dosage = dosagePart;
                                name = nameParts.filter(part => part !== dosagePart).join(' ');
                            }
                        }
                        
                        return `
                            <tr>
                                <td>${name || 'ì•½ë¬¼ëª… ë¯¸ì…ë ¥'}</td>
                                <td>${[dosage, frequency, instructions].filter(Boolean).join(', ') || '-'}</td>
                                <td>${days || '-'}</td>
                                <td>${coverage || '-'}</td>
                            </tr>
                        `;
                    }).join('');

                    const modalContent = `
                        <div style="max-width: 900px; margin: 20px auto; background: white; padding: 0; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden;">
                            <!-- EMR ì–‘ì‹ ì²˜ë°©ì „ -->
                            <div class="prescription-preview" style="
                                background: white;
                                border: 2px solid #333;
                                border-radius: 8px;
                                padding: 30px;
                                margin: 0;
                                font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
                                box-shadow: none;
                            ">
                                <div class="prescription-header" style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: flex-start;
                                    border-bottom: 3px solid #333;
                                    padding-bottom: 20px;
                                    margin-bottom: 30px;
                                ">
                                    <div class="clinic-info" style="text-align: left;">
                                        <h2 style="color: #333; font-size: 1.8em; margin-bottom: 5px;">ì„œëŒ€ ë³‘ì›</h2>
                                        <p style="color: #666; font-size: 0.9em; margin: 2px 0;">ì¶©ë¶ ì²­ì£¼ì‹œ ì„œì›êµ¬ ë¬´ì‹¬ì„œë¡œ 377-3 ì„œì›ëŒ€í•™êµ (ìš°: 28674)</p>
                                        <p style="color: #666; font-size: 0.9em; margin: 2px 0;">ì „í™”: 02-1234-5678 | íŒ©ìŠ¤: 02-1234-5679</p>
                                    </div>
                                    <div class="prescription-title" style="text-align: center;">
                                        <h1 style="color: #333; font-size: 2.2em; margin-bottom: 10px; letter-spacing: 2px;">ì²˜ ë°© ì „</h1>
                                        <p style="color: #666; font-size: 1em;">ë°œí–‰ì¼: ${new Date(prescription.createdAt).toLocaleDateString('ko-KR')}</p>
                                    </div>
                                </div>
                                
                                <div class="prescription-content">
                                    <div class="patient-info-section" style="margin-bottom: 30px;">
                                        <table class="patient-info-table" style="
                                            width: 100%;
                                            border-collapse: collapse;
                                            border: 2px solid #333;
                                        ">
                                            <tr>
                                                <td style="padding: 12px 15px; border: 1px solid #333; font-size: 1em; background: #f8f9fa; width: 120px; font-weight: 600;"><strong>í™˜ìì„±ëª…:</strong></td>
                                                <td style="padding: 12px 15px; border: 1px solid #333; font-size: 1em;">${prescription.patientName}</td>
                                                <td style="padding: 12px 15px; border: 1px solid #333; font-size: 1em; background: #f8f9fa; width: 120px; font-weight: 600;"><strong>ìƒë…„ì›”ì¼:</strong></td>
                                                <td style="padding: 12px 15px; border: 1px solid #333; font-size: 1em;">${prescription.patientBirthDate || '-'}</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 12px 15px; border: 1px solid #333; font-size: 1em; background: #f8f9fa; width: 120px; font-weight: 600;"><strong>ì§„ë‹¨ëª…:</strong></td>
                                                <td colspan="3" style="padding: 12px 15px; border: 1px solid #333; font-size: 1em;">${prescription.diagnosis ? prescription.diagnosis.replace(/\n/g, ', ') : '-'}</td>
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    <div class="prescription-section" style="margin-bottom: 25px;">
                                        <h3 style="color: #333; font-size: 1.3em; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #333;">ì²˜ë°©ë‚´ì—­</h3>
                                        <table class="prescription-table" style="
                                            width: 100%;
                                            border-collapse: collapse;
                                            border: 2px solid #333;
                                        ">
                                            <thead>
                                                <tr>
                                                    <th style="padding: 12px 15px; border: 1px solid #333; text-align: left; background: #f8f9fa; font-weight: 600; color: #333;">ì•½í’ˆëª…</th>
                                                    <th style="padding: 12px 15px; border: 1px solid #333; text-align: left; background: #f8f9fa; font-weight: 600; color: #333;">ìš©ë²•Â·ìš©ëŸ‰</th>
                                                    <th style="padding: 12px 15px; border: 1px solid #333; text-align: left; background: #f8f9fa; font-weight: 600; color: #333;">íˆ¬ì•½ì¼ìˆ˜</th>
                                                    <th style="padding: 12px 15px; border: 1px solid #333; text-align: left; background: #f8f9fa; font-weight: 600; color: #333;">ë¹„ê³ </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${medicationRows || '<tr><td colspan="4" style="padding: 12px 15px; border: 1px solid #333; text-align: center;">ì²˜ë°© ì—†ìŒ</td></tr>'}
                                            </tbody>
                                        </table>
                                    </div>
                                    

                                    
                                    <!-- ì˜ì‚¬ ì†Œê²¬ -->
                                    <div class="prescription-section" style="margin-bottom: 25px;">
                                        <h3 style="color: #333; font-size: 1.3em; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #333;">ì˜ì‚¬ ì†Œê²¬</h3>
                                        <div class="notes-box" style="
                                            border: 2px solid #333;
                                            padding: 15px;
                                            background: #f8f9fa;
                                            min-height: 60px;
                                            border-radius: 4px;
                                        ">
                                            ${prescription.notes || 'íŠ¹ì´ì‚¬í•­ ì—†ìŒ'}
                                        </div>
                                    </div>
                                    
                                    <div class="prescription-section" style="margin-bottom: 25px;">
                                        <h3 style="color: #333; font-size: 1.3em; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #333;">ì¬ì§„ ì˜ˆì •ì¼</h3>
                                        <div class="followup-box" style="
                                            border: 2px solid #333;
                                            padding: 15px;
                                            background: #f8f9fa;
                                            min-height: 60px;
                                            border-radius: 4px;
                                        ">
                                            ${prescription.followUpDate ? new Date(prescription.followUpDate).toLocaleString('ko-KR') : 'ì¬ì§„ ì˜ˆì • ì—†ìŒ'}
                                        </div>
                                    </div>
                                    
                                    <div class="prescription-footer" style="
                                        margin-top: 40px;
                                        display: flex;
                                        justify-content: space-between;
                                        align-items: flex-end;
                                    ">
                                        <div class="doctor-info" style="text-align: left;">
                                            <p style="margin: 5px 0; font-size: 1em;"><strong>ì²˜ë°©ì˜ì‚¬:</strong> ê°•ì°¬í¬ (ë©´í—ˆë²ˆí˜¸: 12345)</p>
                                            <p style="margin: 5px 0; font-size: 1em;"><strong>ì˜ë£Œê¸°ê´€:</strong> ì„œëŒ€ ë³‘ì›</p>
                                        </div>
                                        <div class="prescription-note" style="text-align: right; font-size: 0.9em; color: #666;">
                                            <p style="margin: 3px 0;">â€» ì˜ì•½í’ˆ ë³µìš© ì‹œ ì£¼ì˜ì‚¬í•­ì„ ë°˜ë“œì‹œ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ë²„íŠ¼ ì˜ì—­ -->
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-top: 1px solid #e9ecef;">
                                <button onclick="printPrescriptionBrowser(${prescription.id})" style="background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer; font-size: 1em;">
                                    <i class="fas fa-print"></i> í”„ë¦°íŠ¸ ì¶œë ¥
                                </button>
                                <button onclick="printPrescription(${prescription.id})" style="background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer; font-size: 1em;">
                                    <i class="fas fa-check"></i> ì¶œë ¥ ì™„ë£Œ
                                </button>
                                <button onclick="closeModal()" style="background: #6c757d; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 1em;">
                                    <i class="fas fa-times"></i> ë‹«ê¸°
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // ëª¨ë‹¬ ë°°ê²½ ìƒì„±
                    const modal = document.createElement('div');
                    modal.id = 'prescriptionModal';
                    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto; padding: 20px 0;';
                    modal.innerHTML = modalContent;
                    
                    document.body.appendChild(modal);
                    
                    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            closeModal();
                        }
                    });
                })
                .catch(error => {
                    console.error('ì²˜ë°©ì „ ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                    alert('ì²˜ë°©ì „ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                });
        }

        function closeModal() {
            const modal = document.getElementById('prescriptionModal');
            if (modal) {
                modal.remove();
            }
        }

        // ë¸Œë¼ìš°ì € í”„ë¦°íŠ¸ ê¸°ëŠ¥
        function printPrescriptionBrowser(prescriptionId) {
            // ì²˜ë°©ì „ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            fetch(`${API_BASE_URL}/doctor/prescriptions/${prescriptionId}`)
                .then(response => response.json())
                .then(prescription => {
                    // ì•½ë¬¼ ì •ë³´ íŒŒì‹±
                    const medications = prescription.medications ? prescription.medications.split('\n').filter(med => med.trim()) : [];
                    const medicationRows = medications.map(med => {
                        let name = '';
                        let dosage = '';
                        let frequency = '';
                        let days = '';
                        let instructions = '';
                        let coverage = '';
                        
                        const parts = med.split(' - ');
                        if (parts.length >= 1) {
                            name = parts[0].trim();
                        }
                        if (parts.length >= 2) {
                            const detailParts = parts[1].split(',');
                            detailParts.forEach(part => {
                                const trimmed = part.trim();
                                if (trimmed.includes('ì¼ ') && trimmed.includes('íšŒ')) {
                                    frequency = trimmed;
                                } else if (trimmed.includes('ì¼ë¶„')) {
                                    days = trimmed;
                                } else if (trimmed.includes('ì‹') || trimmed.includes('ì·¨ì¹¨') || trimmed.includes('ì•„ì¹¨') || trimmed.includes('ì €ë…')) {
                                    instructions = trimmed;
                                } else if (trimmed.includes('ê¸‰ì—¬') || trimmed.includes('ë¹„ê¸‰ì—¬')) {
                                    coverage = trimmed.replace(/[()]/g, '');
                                } else if (!frequency && !days && !instructions) {
                                    if (trimmed.includes('mg') || trimmed.includes('g') || trimmed.includes('ml')) {
                                        dosage = trimmed;
                                    } else {
                                        frequency = trimmed;
                                    }
                                }
                            });
                        }
                        
                        if (!dosage && name.includes('mg')) {
                            const nameParts = name.split(' ');
                            const dosagePart = nameParts.find(part => part.includes('mg') || part.includes('g') || part.includes('ml'));
                            if (dosagePart) {
                                dosage = dosagePart;
                                name = nameParts.filter(part => part !== dosagePart).join(' ');
                            }
                        }
                        
                        return `
                            <tr>
                                <td>${name || 'ì•½ë¬¼ëª… ë¯¸ì…ë ¥'}</td>
                                <td>${[dosage, frequency, instructions].filter(Boolean).join(', ') || '-'}</td>
                                <td>${days || '-'}</td>
                                <td>${coverage || '-'}</td>
                            </tr>
                        `;
                    }).join('');

                    // ìƒˆ ì°½ì—ì„œ ì²˜ë°©ì „ ì—´ê¸°
                    const printWindow = window.open('', '_blank', 'width=800,height=600');
                    printWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>ì²˜ë°©ì „ - ${prescription.patientName}</title>
                            <style>
                                body { font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; margin: 0; padding: 20px; }
                                .prescription-preview {
                                    background: white;
                                    border: 2px solid #333;
                                    border-radius: 8px;
                                    padding: 30px;
                                    margin: 0;
                                    box-shadow: none;
                                }
                                .prescription-header {
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: flex-start;
                                    border-bottom: 3px solid #333;
                                    padding-bottom: 20px;
                                    margin-bottom: 30px;
                                }
                                .clinic-info { text-align: left; }
                                .clinic-info h2 { color: #333; font-size: 1.8em; margin-bottom: 5px; }
                                .clinic-info p { color: #666; font-size: 0.9em; margin: 2px 0; }
                                .prescription-title { text-align: center; }
                                .prescription-title h1 { color: #333; font-size: 2.2em; margin-bottom: 10px; letter-spacing: 2px; }
                                .prescription-title p { color: #666; font-size: 1em; }
                                .patient-info-section { margin-bottom: 30px; }
                                .patient-info-table { width: 100%; border-collapse: collapse; border: 2px solid #333; }
                                .patient-info-table td { padding: 12px 15px; border: 1px solid #333; font-size: 1em; }
                                .patient-info-table td:first-child, .patient-info-table td:nth-child(3) { background: #f8f9fa; width: 120px; font-weight: 600; }
                                .prescription-section { margin-bottom: 25px; }
                                .prescription-section h3 { color: #333; font-size: 1.3em; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #333; }
                                .prescription-table { width: 100%; border-collapse: collapse; border: 2px solid #333; }
                                .prescription-table th, .prescription-table td { padding: 12px 15px; border: 1px solid #333; text-align: left; }
                                .prescription-table th { background: #f8f9fa; font-weight: 600; color: #333; }
                                .prescription-table tbody tr:nth-child(even) { background: #f9f9f9; }
                                .notes-box, .followup-box { border: 2px solid #333; padding: 15px; background: #f8f9fa; min-height: 60px; border-radius: 4px; }
                                .prescription-footer { margin-top: 40px; display: flex; justify-content: space-between; align-items: flex-end; }
                                .doctor-info { text-align: left; }
                                .doctor-info p { margin: 5px 0; font-size: 1em; }
                                .prescription-note { text-align: right; font-size: 0.9em; color: #666; }
                                .prescription-note p { margin: 3px 0; }
                                @media print {
                                    body { margin: 0; padding: 0; }
                                    .prescription-preview { border: none; padding: 20px; }
                                }
                            </style>
                        </head>
                        <body>
                            <div class="prescription-preview">
                                <div class="prescription-header">
                                    <div class="clinic-info">
                                        <h2>ì„œëŒ€ ë³‘ì›</h2>
                                        <p>ì¶©ë¶ ì²­ì£¼ì‹œ ì„œì›êµ¬ ë¬´ì‹¬ì„œë¡œ 377-3 ì„œì›ëŒ€í•™êµ (ìš°: 28674)</p>
                                        <p>ì „í™”: 02-1234-5678 | íŒ©ìŠ¤: 02-1234-5679</p>
                                    </div>
                                    <div class="prescription-title">
                                        <h1>ì²˜ ë°© ì „</h1>
                                        <p>ë°œí–‰ì¼: ${new Date(prescription.createdAt).toLocaleDateString('ko-KR')}</p>
                                    </div>
                                </div>
                                
                                <div class="prescription-content">
                                    <div class="patient-info-section">
                                        <table class="patient-info-table">
                                            <tr>
                                                <td><strong>í™˜ìì„±ëª…:</strong></td>
                                                <td>${prescription.patientName}</td>
                                                <td><strong>ìƒë…„ì›”ì¼:</strong></td>
                                                <td>${prescription.patientBirthDate || '-'}</td>
                                            </tr>
                                            <tr>
                                                <td><strong>ì§„ë‹¨ëª…:</strong></td>
                                                <td colspan="3">${prescription.diagnosis ? prescription.diagnosis.replace(/\n/g, ', ') : '-'}</td>
                                            </tr>
                                        </table>
                                    </div>
                                    
                                    <div class="prescription-section">
                                        <h3>ì²˜ë°©ë‚´ì—­</h3>
                                        <table class="prescription-table">
                                            <thead>
                                                <tr>
                                                    <th>ì•½í’ˆëª…</th>
                                                    <th>ìš©ë²•Â·ìš©ëŸ‰</th>
                                                    <th>íˆ¬ì•½ì¼ìˆ˜</th>
                                                    <th>ë¹„ê³ </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${medicationRows || '<tr><td colspan="4" style="text-align: center;">ì²˜ë°© ì—†ìŒ</td></tr>'}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="prescription-section">
                                        <h3>ì˜ì‚¬ ì†Œê²¬</h3>
                                        <div class="notes-box">
                                            ${prescription.notes || 'íŠ¹ì´ì‚¬í•­ ì—†ìŒ'}
                                        </div>
                                    </div>
                                    
                                    <div class="prescription-section">
                                        <h3>ì¬ì§„ ì˜ˆì •ì¼</h3>
                                        <div class="followup-box">
                                                                                         ${prescription.followUpDate ? new Date(prescription.followUpDate).toLocaleString('ko-KR') : 'ì¬ì§„ ì˜ˆì • ì—†ìŒ'}
                                        </div>
                                    </div>
                                    
                                    <div class="prescription-footer">
                                        <div class="doctor-info">
                                            <p><strong>ì²˜ë°©ì˜ì‚¬:</strong> ê°•ì°¬í¬ (ë©´í—ˆë²ˆí˜¸: 12345)</p>
                                            <p><strong>ì˜ë£Œê¸°ê´€:</strong> ì„œëŒ€ ë³‘ì›</p>
                                        </div>
                                        <div class="prescription-note">
                                            <p>â€» ì˜ì•½í’ˆ ë³µìš© ì‹œ ì£¼ì˜ì‚¬í•­ì„ ë°˜ë“œì‹œ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </body>
                        </html>
                    `);
                    
                    printWindow.document.close();
                    
                    // ì ì‹œ í›„ í”„ë¦°íŠ¸ ëŒ€í™”ìƒì ì—´ê¸°
                    setTimeout(() => {
                        printWindow.print();
                        
                        // í”„ë¦°íŠ¸ í›„ ì°½ ë‹«ê¸°
                        setTimeout(() => {
                            printWindow.close();
                        }, 100);
                    }, 500);
                })
                .catch(error => {
                    console.error('ì²˜ë°©ì „ í”„ë¦°íŠ¸ ì‹¤íŒ¨:', error);
                    alert('ì²˜ë°©ì „ í”„ë¦°íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
        }

        // ì¶œë ¥ ì™„ë£Œ ì²˜ë¦¬
        function printPrescription(prescriptionId) {
            const confirmed = confirm('ì²˜ë°©ì „ì„ ì¶œë ¥í•˜ì…¨ìŠµë‹ˆê¹Œ?\nì¶œë ¥ ì™„ë£Œ ì²˜ë¦¬í•˜ë©´ ëª©ë¡ì—ì„œ ì œê±°ë©ë‹ˆë‹¤.');
            if (!confirmed) {
                return;
            }

            console.log('ì²˜ë°©ì „ ì¶œë ¥ ì™„ë£Œ ìš”ì²­:', {
                prescriptionId: prescriptionId,
                apiUrl: `${API_BASE_URL}/nurse/prescriptions/${prescriptionId}/print`
            });

            fetch(`${API_BASE_URL}/nurse/prescriptions/${prescriptionId}/print`, {
                method: 'GET'
            })
            .then(response => {
                console.log('ì²˜ë°©ì „ ì¶œë ¥ ì™„ë£Œ ì‘ë‹µ ìƒíƒœ:', response.status);
                if (!response.ok) {
                    return response.text().then(text => {
                        let errorMessage = 'ì²˜ë°©ì „ ì¶œë ¥ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨';
                        try {
                            const errorData = JSON.parse(text);
                            errorMessage = errorData.message || errorMessage;
                        } catch (e) {
                            if (text) {
                                errorMessage = text;
                            }
                        }
                        throw new Error(`HTTP ${response.status}: ${errorMessage}`);
                    });
                }
                return response.json();
            })
            .then(result => {
                console.log('ì²˜ë°©ì „ ì¶œë ¥ ì™„ë£Œ ì„±ê³µ:', result);
                alert(`ì²˜ë°©ì „ ì¶œë ¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\ní™˜ìëª…: ${result.patientName}`);
                closeModal(); // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
                
                // ì²˜ë°©ì „ ì¶œë ¥ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                loadPendingPrescriptions();
                
                // í˜„ì¬ íƒ­ì´ ì²˜ë°©ì „ ì¶œë ¥ íƒ­ì´ë©´ ì¦‰ì‹œ ë°˜ì˜
                if (currentTab === 'prescriptions') {
                    setTimeout(() => {
                        loadPendingPrescriptions();
                    }, 500); // 0.5ì´ˆ í›„ í•œ ë²ˆ ë” ìƒˆë¡œê³ ì¹¨
                }
            })
            .catch(error => {
                console.error('ì²˜ë°©ì „ ì¶œë ¥ ì™„ë£Œ ì‹¤íŒ¨:', error);
                alert('ì²˜ë°©ì „ ì¶œë ¥ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            });
        }

        // ========== í†µê³„ ê´€ë ¨ í•¨ìˆ˜ë“¤ ==========
        let currentPeriod = 'today';
        let hourlyChart, weeklyChart, ageChart;

        // í†µê³„ ë¡œë“œ
        function loadStatistics(period) {
            currentPeriod = period;
            
            // ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-period="${period}"]`).classList.add('active');

            // ì‚¬ìš©ì ì •ì˜ ê¸°ê°„ ìˆ¨ê¸°ê¸°
            document.getElementById('customPeriodDiv').style.display = 'none';

            // ë¡œë”© í‘œì‹œ
            document.getElementById('statisticsLoading').style.display = 'block';
            document.getElementById('statisticsContent').style.display = 'none';

            const url = `${API_BASE_URL}/nurse/statistics/${period}`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    renderStatistics(data);
                })
                .catch(error => {
                    console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('statisticsContent').innerHTML = `
                        <div class="empty-state">
                            <h3>âš ï¸ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                    document.getElementById('statisticsContent').style.display = 'block';
                })
                .finally(() => {
                    document.getElementById('statisticsLoading').style.display = 'none';
                });
        }

        // ì‚¬ìš©ì ì •ì˜ ê¸°ê°„ í‘œì‹œ
        function showCustomPeriod() {
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('[data-period="custom"]').classList.add('active');
            
            document.getElementById('customPeriodDiv').style.display = 'block';
            
            // ê¸°ë³¸ê°’ ì„¤ì • (ì§€ë‚œ 7ì¼)
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            document.getElementById('startDate').value = weekAgo.toISOString().split('T')[0];
        }

        // ì‚¬ìš©ì ì •ì˜ ê¸°ê°„ í†µê³„ ë¡œë“œ
        function loadCustomStatistics() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!startDate || !endDate) {
                alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                alert('ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            document.getElementById('statisticsLoading').style.display = 'block';
            document.getElementById('statisticsContent').style.display = 'none';

            const url = `${API_BASE_URL}/nurse/statistics/custom?startDate=${startDate}&endDate=${endDate}`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    renderStatistics(data);
                })
                .catch(error => {
                    console.error('ì‚¬ìš©ì ì •ì˜ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                    alert('í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                })
                .finally(() => {
                    document.getElementById('statisticsLoading').style.display = 'none';
                });
        }

        // í†µê³„ ë Œë”ë§
        function renderStatistics(data) {
            // ê¸°ë³¸ í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('totalVisits').textContent = data.totalVisits || 0;
            document.getElementById('totalNewPatients').textContent = data.totalNewPatients || 0;
            document.getElementById('totalPrescriptions').textContent = data.totalPrescriptions || 0;
            document.getElementById('averageWaitingTime').textContent = Math.round(data.averageWaitingTime || 0);

            // í”¼í¬ ì‹œê°„ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('busiestHour').textContent = data.busiestHour || 'ì •ë³´ ì—†ìŒ';
            document.getElementById('busiestDay').textContent = data.busiestDay || 'ì •ë³´ ì—†ìŒ';

            // ì°¨íŠ¸ ë Œë”ë§
            renderHourlyChart(data.hourlyStats || []);
            renderWeeklyChart(data.weeklyStats || []);
            renderAgeChart(data.ageGroupStats || []);

            // ì»¨í…ì¸  í‘œì‹œ
            document.getElementById('statisticsContent').style.display = 'block';
        }

        // ì‹œê°„ëŒ€ë³„ ì°¨íŠ¸
        function renderHourlyChart(hourlyStats) {
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            
            if (hourlyChart) {
                hourlyChart.destroy();
            }

            const labels = [];
            const data = [];
            
            // 0ì‹œë¶€í„° 23ì‹œê¹Œì§€ ëª¨ë“  ì‹œê°„ëŒ€ ìƒì„±
            for (let hour = 0; hour < 24; hour++) {
                const timeRange = `${hour.toString().padStart(2, '0')}:00-${(hour + 1).toString().padStart(2, '0')}:00`;
                labels.push(timeRange);
                
                const stat = hourlyStats.find(s => s.hour === hour);
                data.push(stat ? stat.visitCount : 0);
            }

            hourlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë°©ë¬¸ì ìˆ˜',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // ìš”ì¼ë³„ ì°¨íŠ¸
        function renderWeeklyChart(weeklyStats) {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            
            if (weeklyChart) {
                weeklyChart.destroy();
            }

            const dayNames = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
            const data = [];
            
            // ëª¨ë“  ìš”ì¼ ë°ì´í„° ìƒì„±
            for (let i = 1; i <= 7; i++) {
                const stat = weeklyStats.find(s => s.dayOfWeek === i);
                data.push(stat ? stat.visitCount : 0);
            }

            weeklyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dayNames,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 205, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)',
                            'rgba(255, 159, 64, 0.6)',
                            'rgba(199, 199, 199, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 205, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(199, 199, 199, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ì—°ë ¹ëŒ€ë³„ ì°¨íŠ¸
        function renderAgeChart(ageGroupStats) {
            const ctx = document.getElementById('ageChart').getContext('2d');
            
            if (ageChart) {
                ageChart.destroy();
            }

            if (ageGroupStats.length === 0) {
                // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë¹ˆ ì°¨íŠ¸ í‘œì‹œ
                ageChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['ë°ì´í„° ì—†ìŒ'],
                        datasets: [{
                            data: [1],
                            backgroundColor: ['rgba(200, 200, 200, 0.6)'],
                            borderColor: ['rgba(200, 200, 200, 1)'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                return;
            }

            const labels = ageGroupStats.map(stat => stat.ageGroup);
            const data = ageGroupStats.map(stat => stat.visitCount);

            ageChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 205, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)',
                            'rgba(255, 159, 64, 0.6)',
                            'rgba(199, 199, 199, 0.6)',
                            'rgba(83, 102, 255, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 205, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(199, 199, 199, 1)',
                            'rgba(83, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ========== ëŒ€ê¸°ì‹œê°„ ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ë“¤ ==========
        
        // ëŒ€ê¸°ì‹œê°„ ì„¤ì • ë¡œë“œ
        function loadWaitingTimeSettings() {
            const savedTime = localStorage.getItem('waitingTimePerPerson');
            const timePerPerson = savedTime ? parseInt(savedTime) : 3; // ê¸°ë³¸ê°’ 3ë¶„
            
            document.getElementById('waitingTimePerPerson').value = timePerPerson;
            updateWaitingTimeDisplay(timePerPerson);
        }
        
        // ëŒ€ê¸°ì‹œê°„ ì„¤ì • ì—…ë°ì´íŠ¸
        function updateWaitingTime() {
            const timePerPerson = parseInt(document.getElementById('waitingTimePerPerson').value);
            
            if (timePerPerson < 1 || timePerPerson > 30) {
                alert('ëŒ€ê¸°ì‹œê°„ì€ 1ë¶„ì—ì„œ 30ë¶„ ì‚¬ì´ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('waitingTimePerPerson', timePerPerson);
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            updateWaitingTimeDisplay(timePerPerson);
            
            alert(`ëŒ€ê¸°ì‹œê°„ì´ 1ëª…ë‹¹ ${timePerPerson}ë¶„ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ëŒ€ê¸°ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateWaitingTimeDisplay(timePerPerson) {
            document.getElementById('currentWaitingTimeDisplay').textContent = `1ëª…ë‹¹ ${timePerPerson}ë¶„`;
            
            // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            const preview = document.getElementById('waitingTimePreview');
            preview.innerHTML = `
                <div>â€¢ ëŒ€ê¸° 0ëª…: 0ë¶„</div>
                <div>â€¢ ëŒ€ê¸° 1ëª…: ${timePerPerson}ë¶„</div>
                <div>â€¢ ëŒ€ê¸° 2ëª…: ${timePerPerson * 2}ë¶„</div>
                <div>â€¢ ëŒ€ê¸° 3ëª…: ${timePerPerson * 3}ë¶„</div>
                <div>â€¢ ëŒ€ê¸° 5ëª…: ${timePerPerson * 5}ë¶„</div>
            `;
        }
        
        // ëŒ€ê¸°ì‹œê°„ ê³„ì‚° (ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ í•¨ìˆ˜)
        function calculateWaitingTime(waitingCount) {
            const timePerPerson = parseInt(localStorage.getItem('waitingTimePerPerson') || '3');
            return waitingCount * timePerPerson;
        }

        // ========== SMS ê´€ë ¨ í•¨ìˆ˜ë“¤ ==========

        // SMS ëª¨ë“œ ìƒíƒœ ë¡œë“œ
        function loadSmsMode() {
            fetch(`${API_BASE_URL}/nurse/sms-mode`)
                .then(response => response.json())
                .then(data => {
                    const modeDisplay = document.getElementById('currentModeDisplay');
                    const simulationBtn = document.getElementById('simulationModeBtn');
                    const realBtn = document.getElementById('realModeBtn');
                    
                    modeDisplay.textContent = data.currentMode;
                    
                    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    if (data.simulationMode) {
                        simulationBtn.classList.add('active');
                        simulationBtn.style.backgroundColor = '#ff9800';
                        simulationBtn.style.color = 'white';
                        realBtn.classList.remove('active');
                        realBtn.style.backgroundColor = '';
                        realBtn.style.color = '';
                        modeDisplay.style.color = '#ff9800';
                    } else {
                        realBtn.classList.add('active');
                        realBtn.style.backgroundColor = '#28a745';
                        realBtn.style.color = 'white';
                        simulationBtn.classList.remove('active');
                        simulationBtn.style.backgroundColor = '';
                        simulationBtn.style.color = '';
                        modeDisplay.style.color = '#28a745';
                    }
                })
                .catch(error => {
                    console.error('SMS ëª¨ë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('currentModeDisplay').textContent = 'ë¡œë“œ ì‹¤íŒ¨';
                });
        }

        // SMS ëª¨ë“œ ì„¤ì •
        function setSmsMode(simulationMode) {
            const confirmMessage = simulationMode 
                ? 'ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì‹¤ì œ SMS ë°œì†¡ ì—†ì´ ë¡œê·¸ë§Œ ì¶œë ¥ë©ë‹ˆë‹¤)'
                : 'ì‹¤ì œ ë°œì†¡ ëª¨ë“œë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì‹¤ì œ SMSê°€ ë°œì†¡ë˜ì–´ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤)';
            
            if (!confirm(confirmMessage)) {
                return;
            }

            const formData = new FormData();
            formData.append('simulationMode', simulationMode);

            fetch(`${API_BASE_URL}/nurse/sms-mode`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(result => {
                alert(result);
                loadSmsMode(); // ëª¨ë“œ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
            })
            .catch(error => {
                console.error('SMS ëª¨ë“œ ì„¤ì • ì‹¤íŒ¨:', error);
                alert('SMS ëª¨ë“œ ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // SMS í…ŒìŠ¤íŠ¸ ë°œì†¡
        function sendTestSms() {
            const phoneNumber = document.getElementById('testPhoneNumber').value;
            const patientName = document.getElementById('testMessage').value || 'í…ŒìŠ¤íŠ¸ í™˜ì';
            const resultDiv = document.getElementById('testSmsResult');

            if (!phoneNumber) {
                showTestResult('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì¦
            const phoneRegex = /^01[0-9]-?\d{3,4}-?\d{4}$/;
            if (!phoneRegex.test(phoneNumber.replace(/[^0-9]/g, ''))) {
                showTestResult('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 010-1234-5678)', 'error');
                return;
            }

            showTestResult('SMS ë°œì†¡ ì¤‘...', 'info');

            fetch(`${API_BASE_URL}/nurse/test-sms`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    phoneNumber: phoneNumber,
                    patientName: patientName
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showTestResult(result.message, 'success');
                    document.getElementById('testPhoneNumber').value = '';
                    document.getElementById('testMessage').value = '';
                } else {
                    showTestResult(result.message, 'error');
                }
            })
            .catch(error => {
                console.error('SMS í…ŒìŠ¤íŠ¸ ë°œì†¡ ì‹¤íŒ¨:', error);
                showTestResult('SMS ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ
        function showTestResult(message, type) {
            const resultDiv = document.getElementById('testSmsResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = message;
            
            // ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            resultDiv.classList.remove('success', 'error', 'info');
            
            switch(type) {
                case 'success':
                    resultDiv.style.backgroundColor = '#d4edda';
                    resultDiv.style.color = '#155724';
                    resultDiv.style.border = '1px solid #c3e6cb';
                    break;
                case 'error':
                    resultDiv.style.backgroundColor = '#f8d7da';
                    resultDiv.style.color = '#721c24';
                    resultDiv.style.border = '1px solid #f5c6cb';
                    break;
                case 'info':
                    resultDiv.style.backgroundColor = '#d1ecf1';
                    resultDiv.style.color = '#0c5460';
                    resultDiv.style.border = '1px solid #bee5eb';
                    break;
            }
            
            // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }



        // ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ… (SMS í…ŒìŠ¤íŠ¸ìš©)
        document.getElementById('testPhoneNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 3 && value.length <= 7) {
                value = value.replace(/(\d{3})(\d{1,4})/, '$1-$2');
            } else if (value.length >= 8) {
                value = value.replace(/(\d{3})(\d{4})(\d{1,4})/, '$1-$2-$3');
            }
            e.target.value = value;
        });

        // ========== ì•”í˜¸ í™•ì¸ í•¨ìˆ˜ ==========
        
        // ì•”í˜¸ í™•ì¸
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('passwordError');
            
            // ê°„í˜¸ì‚¬ í˜ì´ì§€ ì•”í˜¸ (ì‹¤ì œ ìš´ì˜ì—ì„œëŠ” ë” ì•ˆì „í•œ ë°©ë²• ì‚¬ìš©)
            const correctPassword = 'nurse123';
            
            if (password === correctPassword) {
                // ì•”í˜¸ ë§ìŒ - ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
                document.getElementById('passwordOverlay').style.display = 'none';
                document.querySelector('.main-content').style.display = 'block';
                
                // ë°ì´í„° ë¡œë“œ ì‹œì‘
                loadData();
            } else {
                // ì•”í˜¸ í‹€ë¦¼
                errorDiv.textContent = 'ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                
                // ì—ëŸ¬ ë©”ì‹œì§€ 3ì´ˆ í›„ ìë™ ì‚­ì œ
                setTimeout(() => {
                    errorDiv.textContent = '';
                }, 3000);
            }
        }
        
        // ì—”í„°í‚¤ë¡œ ì•”í˜¸ í™•ì¸
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // ========== EMR ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ==========
        
        // Vital Sign ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadConfirmedPatients() {
            const select = document.getElementById('vitalPatientSelect');
            
            // í™•ì¸ëœ ì ‘ìˆ˜ ëª©ë¡ì—ì„œ í™˜ì ì •ë³´ ì¶”ì¶œ
            fetch(`${API_BASE_URL}/nurse/confirmed`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(receptions => {
                    console.log('í™•ì¸ëœ ì ‘ìˆ˜ ëª©ë¡:', receptions);
                    
                    // ë°°ì—´ì¸ì§€ í™•ì¸
                    if (!Array.isArray(receptions)) {
                        console.error('ì‘ë‹µì´ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', receptions);
                        receptions = [];
                    }
                    
                    // Vital Sign í™˜ì ì„ íƒ (ì§„ë£Œ ì „ í™˜ìë“¤)
                    select.innerHTML = '<option value="">í™˜ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                    receptions.forEach(reception => {
                        const option = document.createElement('option');
                        option.value = reception.id; // reception ID ì‚¬ìš©
                        option.textContent = `${reception.patientName} (${reception.birthDate || 'ìƒë…„ì›”ì¼ ë¯¸ë“±ë¡'})`;
                        option.dataset.patientInfo = JSON.stringify(reception);
                        select.appendChild(option);
                    });
                    
                    console.log(`Vital Sign í™˜ì ì„ íƒì— ${receptions.length}ëª… ì¶”ê°€ë¨`);
                })
                .catch(error => {
                    console.error('Vital Sign í™˜ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    select.innerHTML = '<option value="">í™˜ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</option>';
                });
        }
        
        // í™˜ì ì„ íƒ ì‹œ Vital Sign í¼ í‘œì‹œ
        document.getElementById('vitalPatientSelect').addEventListener('change', function() {
            const form = document.getElementById('vitalSignForm');
            if (this.value) {
                form.style.display = 'block';
                // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
                clearVitalForm();
            } else {
                form.style.display = 'none';
            }
        });
        
        // Vital Sign ì €ì¥
        function saveVitalSigns() {
            const patientSelect = document.getElementById('vitalPatientSelect');
            const selectedPatient = patientSelect.value;
            
            if (!selectedPatient) {
                alert('í™˜ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê°„í˜¸ì‚¬ ID ê°€ì ¸ì˜¤ê¸°
            // ì²´í¬ëœ ì¦ìƒë“¤ ìˆ˜ì§‘
            const symptoms = Array.from(document.querySelectorAll('input[name="symptoms"]:checked'))
                .map(cb => cb.value);
            
            // ì²´í¬ëœ ê³¼ê±°ë ¥ ìˆ˜ì§‘
            const history = Array.from(document.querySelectorAll('input[name="history"]:checked'))
                .map(cb => cb.value);
            
            const vitalData = {
                receptionId: parseInt(selectedPatient),
                bodyTemp: document.getElementById('bodyTemp').value ? parseFloat(document.getElementById('bodyTemp').value) : null,
                bloodPressure: document.getElementById('bloodPressure').value || null,
                pulse: document.getElementById('pulse').value ? parseInt(document.getElementById('pulse').value) : null,
                symptoms: symptoms.join(', ') || null,
                otherSymptoms: document.getElementById('otherSymptoms').value || null,
                medicalHistory: history.join(', ') || null,
                nurseNotes: document.getElementById('nurseNotes').value || null
            };
            
            console.log('Vital Sign ì €ì¥ ìš”ì²­:', vitalData);
            
            fetch(`${API_BASE_URL}/nurse/vital-sign`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(vitalData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        let errorMessage = 'Vital Sign ì €ì¥ ì‹¤íŒ¨';
                        try {
                            const errorData = JSON.parse(text);
                            errorMessage = errorData.message || errorMessage;
                        } catch (e) {
                            if (text) {
                                errorMessage = text;
                            }
                        }
                        throw new Error(`HTTP ${response.status}: ${errorMessage}`);
                    });
                }
                return response.json();
            })
            .then(result => {
                console.log('Vital Sign ì €ì¥ ì„±ê³µ:', result);
                alert(`Vital Signì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\ní™˜ì: ${result.patientName}`);
                clearVitalForm();
                
                // í™˜ì ì„ íƒ ì´ˆê¸°í™”
                document.getElementById('vitalPatientSelect').value = '';
                document.getElementById('vitalSignForm').style.display = 'none';
            })
            .catch(error => {
                console.error('Vital Sign ì €ì¥ ì‹¤íŒ¨:', error);
                alert('Vital Sign ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            });
        }
        
        // Vital Sign í¼ ì´ˆê¸°í™”
        function clearVitalForm() {
            document.getElementById('bodyTemp').value = '';
            document.getElementById('bloodPressure').value = '';
            document.getElementById('pulse').value = '';
            document.getElementById('otherSymptoms').value = '';
            document.getElementById('nurseNotes').value = '';
            
            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            document.querySelectorAll('input[name="symptoms"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[name="history"]').forEach(cb => cb.checked = false);
        }
        
        // ëŒ€ê¸° ì¸ì›ì— ë”°ë¼ ì•Œë¦¼ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateManualNotifyRadios(waitingCount) {
            const yesRadio = document.getElementById('manualNotifyYes');
            const noRadio = document.getElementById('manualNotifyNo');
            const notifyInfo = document.getElementById('manualNotifyInfo');
            
            console.log('ëŒ€ê¸°ì ìˆ˜ ì—…ë°ì´íŠ¸:', waitingCount);
            
            // ê¸°ë³¸ê°’ì€ í•­ìƒ "ì•Œë¦¼ ë°›ì§€ ì•Šê¸°"
            yesRadio.checked = false;
            noRadio.checked = true;
            
            // ëŒ€ê¸° ì¸ì›ì— ë”°ë¥¸ ì„ íƒ ê°€ëŠ¥ ì—¬ë¶€ ì„¤ì •
            if (waitingCount >= 2) {
                // 2ëª… ì´ìƒì¼ ë•Œë§Œ ì„ íƒ ê°€ëŠ¥
                yesRadio.disabled = false;
                noRadio.disabled = false;
                notifyInfo.textContent = `í˜„ì¬ ì§„ë£Œ ëŒ€ê¸° ì¸ì› ${waitingCount}ëª… - SMS ì•Œë¦¼ ë°œì†¡ ê°€ëŠ¥`;
                notifyInfo.style.color = '#28a745';
            } else {
                // 2ëª… ë¯¸ë§Œì¼ ë•ŒëŠ” ì„ íƒ ë¶ˆê°€, "ì•Œë¦¼ ë°›ì§€ ì•Šê¸°"ë¡œ ê³ ì •
                yesRadio.disabled = true;
                noRadio.disabled = true;
                yesRadio.checked = false;
                noRadio.checked = true;
                notifyInfo.textContent = `í˜„ì¬ ì§„ë£Œ ëŒ€ê¸° ì¸ì› ${waitingCount}ëª… - 2ëª… ì´ìƒì¼ ë•Œë§Œ SMS ì•Œë¦¼ ë°œì†¡ ê°€ëŠ¥`;
                notifyInfo.style.color = '#6c757d';
            }
        }

        // ìˆ˜ê¸° ì ‘ìˆ˜ í¼ì´ ì—´ë¦´ ë•Œ ëŒ€ê¸° ì¸ì› fetch í›„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function openManualRegisterForm() {
            fetch(`${API_BASE_URL}/patient/waiting-count`)
                .then(res => res.json())
                .then(waitingCount => {
                    updateManualNotifyRadios(waitingCount);
                    // ... ê¸°ì¡´ í¼ ì´ˆê¸°í™” ì½”ë“œ ...
                })
                .catch(error => {
                    console.error('ëŒ€ê¸°ì ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    updateManualNotifyRadios(0); // ì—ëŸ¬ ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì²˜ë¦¬
                });
        }

        // ì¼ë°˜ í™˜ì ì ‘ìˆ˜ í¼ì´ ì—´ë¦´ ë•Œ ëŒ€ê¸° ì¸ì› fetch í›„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function openGeneralRegisterForm() {
            fetch(`${API_BASE_URL}/patient/waiting-count`)
                .then(res => res.json())
                .then(waitingCount => {
                    updateManualNotifyRadios(waitingCount);
                })
                .catch(error => {
                    console.error('ëŒ€ê¸°ì ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    updateManualNotifyRadios(0); // ì—ëŸ¬ ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì²˜ë¦¬
                });
        }





        // ========== SMS ê´€ë ¨ í•¨ìˆ˜ë“¤ ==========

        // SMS ì•Œë¦¼ ë°œì†¡ ì‹œì  ì„¤ì • ë¡œë“œ
        function loadNotifyTimingSettings() {
            // ì„œë²„ì—ì„œ í˜„ì¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            fetch(`${API_BASE_URL}/nurse/sms-timing`)
                .then(response => response.json())
                .then(timing => {
            document.getElementById('notifyTiming').value = timing;
            updateNotifyTimingDisplay(timing);
                })
                .catch(error => {
                    console.error('SMS ì•Œë¦¼ ë°œì†¡ ì‹œì  ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                    // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš©
                    const timing = 2;
                    document.getElementById('notifyTiming').value = timing;
                    updateNotifyTimingDisplay(timing);
                });
        }
        
        // SMS ì•Œë¦¼ ë°œì†¡ ì‹œì  ì„¤ì • ì—…ë°ì´íŠ¸
        function updateNotifyTiming() {
            const timing = parseInt(document.getElementById('notifyTiming').value);
            
            if (timing < 1 || timing > 5) {
                alert('ì•Œë¦¼ ë°œì†¡ ì‹œì ì€ 1ëª…ì—ì„œ 5ëª… ì‚¬ì´ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì„œë²„ì— ì„¤ì • ì €ì¥
            fetch(`${API_BASE_URL}/nurse/sms-timing`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `timing=${timing}`
            })
            .then(response => response.text())
            .then(message => {
            // í™”ë©´ ì—…ë°ì´íŠ¸
            updateNotifyTimingDisplay(timing);
                alert(message);
                
                // ì ‘ìˆ˜ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (ë³€ê²½ëœ ì„¤ì • ë°˜ì˜)
                loadReceptions();
            })
            .catch(error => {
                console.error('SMS ì•Œë¦¼ ë°œì†¡ ì‹œì  ì„¤ì • ì‹¤íŒ¨:', error);
                alert('ì„¤ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            });
        }
        
        // SMS ì•Œë¦¼ ë°œì†¡ ì‹œì  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateNotifyTimingDisplay(timing) {
            let displayText;
            if (timing === 1) {
                displayText = 'ë°”ë¡œ ë‹¤ìŒ ì°¨ë¡€ì¼ ë•Œ ì•Œë¦¼ ë°œì†¡';
            } else {
                displayText = `ì• ëŒ€ê¸°ìê°€ ${timing - 1}ëª… ë‚¨ì•˜ì„ ë•Œ ì•Œë¦¼ ë°œì†¡ (${timing}ë²ˆì§¸ ìˆœì„œ)`;
            }
            document.getElementById('currentNotifyTimingDisplay').textContent = displayText;
        }

        // JS: showExistingPatientInfo í•¨ìˆ˜ í•˜ë‹¨ì— ì¶”ê°€
        let currentEditingPatient = null;
        document.addEventListener('DOMContentLoaded', function() {
            const infoDiv = document.getElementById('existingPatientInfo');
            infoDiv.addEventListener('click', function(e) {
                if (e.target && e.target.id === 'editPatientBtn') {
                    startEditPatient();
                } else if (e.target && e.target.id === 'savePatientBtn') {
                    saveEditPatient();
                } else if (e.target && e.target.id === 'cancelEditPatientBtn') {
                    cancelEditPatient();
                }
            });
        });
        function startEditPatient() {
            if (!currentSelectedPatient) return;
            currentEditingPatient = {...currentSelectedPatient};
            document.getElementById('existingPatientBasicInfo').style.display = 'none';
            document.getElementById('editPatientForm').style.display = 'flex';
            document.getElementById('editPatientName').value = currentSelectedPatient.name;
            document.getElementById('editPatientBirth').value = currentSelectedPatient.birthDate;
            document.getElementById('editPatientPhone').value = currentSelectedPatient.phoneNumber || '';
        }
        function cancelEditPatient() {
            document.getElementById('existingPatientBasicInfo').style.display = 'flex';
            document.getElementById('editPatientForm').style.display = 'none';
        }
        function saveEditPatient() {
            const name = document.getElementById('editPatientName').value.trim();
            const birthDate = document.getElementById('editPatientBirth').value;
            const phoneNumber = document.getElementById('editPatientPhone').value.trim();
            if (!name || !birthDate) {
                alert('ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            fetch(`${API_BASE_URL}/nurse/patient/${currentSelectedPatient.patientId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, birthDate, phoneNumber })
            })
            .then(res => {
                if (!res.ok) throw new Error('ìˆ˜ì • ì‹¤íŒ¨');
                return res.json();
            })
            .then(updated => {
                showExistingPatientInfo(updated);
                document.getElementById('existingPatientBasicInfo').style.display = 'flex';
                document.getElementById('editPatientForm').style.display = 'none';
                alert('í™˜ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            })
            .catch(err => {
                alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: ' + err.message);
            });
        }
        // showExistingPatientInfoì—ì„œ currentSelectedPatientë„ ê°±ì‹ 
        function showExistingPatientInfo(patient) {
            currentSelectedPatient = patient;
            document.getElementById('existingPatientName').textContent = patient.name;
            document.getElementById('existingPatientBirth').textContent = patient.birthDate;
            document.getElementById('existingPatientPhone').textContent = patient.phoneNumber || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ';
            document.getElementById('existingVisitCount').textContent = patient.totalVisits;
            document.getElementById('existingLastVisit').textContent = patient.lastVisit ? formatDateTime(patient.lastVisit) : 'ì—†ìŒ';
            if (patient.latestSurvey && patient.latestSurvey.symptoms) {
                document.getElementById('existingSymptomsText').textContent = patient.latestSurvey.symptoms;
                document.getElementById('existingSymptoms').style.display = 'block';
            } else {
                document.getElementById('existingSymptoms').style.display = 'none';
            }
            document.getElementById('existingPatientInfo').style.display = 'block';
            document.getElementById('existingPatientBasicInfo').style.display = 'flex';
            document.getElementById('editPatientForm').style.display = 'none';
        }


    </script>
    </div> <!-- main-content ë -->
</body>
</html> 