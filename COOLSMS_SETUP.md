# COOLSMS 설정 가이드

## 1. COOLSMS 계정 생성 및 설정

### 1.1 COOLSMS 회원가입
1. [COOLSMS 웹사이트](https://www.coolsms.co.kr/)에서 회원가입
2. 본인인증 및 사업자 등록증 업로드 (필요시)
3. 계정 활성화 대기

### 1.2 API 키 발급
1. COOLSMS 관리자 페이지 로그인
2. `개발자 센터` → `API Key 관리` 메뉴 이동
3. `새 API Key 생성` 클릭
4. API Key와 API Secret 복사하여 안전한 곳에 보관

### 1.3 발신번호 등록
1. `발신번호 관리` 메뉴 이동
2. `발신번호 등록` 클릭
3. 병원 대표번호 입력 및 인증 완료

## 2. 애플리케이션 설정

### 2.1 application.yml 수정
```yaml
# COOLSMS 설정
coolsms:
  api-key: NCSA**************  # 발급받은 API Key
  api-secret: ****************  # 발급받은 API Secret
  from-number: 01012345678     # 등록된 발신번호 (하이픈 제거)
```

### 2.2 설정 확인
- API Key: COOLSMS에서 발급받은 실제 키로 교체
- API Secret: COOLSMS에서 발급받은 실제 시크릿으로 교체
- from-number: 병원에서 등록한 발신번호로 교체

## 3. SMS 발송 로직

### 3.1 대기 순서 알림 (2팀 전)
- **조건**: 대기 환자가 3명 이상일 때
- **대상**: 3번째 순서부터 모든 대기 환자
- **발송 시점**: 
  - 새로운 환자가 접수 확인될 때
  - 환자가 호출되어 대기 순서가 변경될 때
- **메시지 내용**:
  ```
  [병원 대기 알림]
  홍길동님, 곧 진료 차례입니다.
  현재 대기 순서: 3번째
  약 2명 후 진료실로 들어오세요.
  ```

### 3.2 호출 알림
- **조건**: 환자가 호출될 때
- **대상**: 호출된 환자
- **발송 시점**: 의사가 "다음 환자 호출" 버튼을 클릭했을 때
- **메시지 내용**:
  ```
  [병원 호출 알림]
  홍길동님, 진료실로 입장해 주세요!
  ```

### 3.3 SMS 발송 조건
- SMS 알림 설정이 활성화된 환자만
- 유효한 전화번호가 등록된 환자만
- 중복 발송 방지 (동일한 순서에 대해 한 번만 발송)

## 4. 개발 환경에서의 테스트

### 4.1 개발 모드
현재 설정이 `YOUR_API_KEY`로 되어 있으면 실제 SMS를 발송하지 않고 로그만 출력합니다.

```
2024-01-15 10:30:00 INFO  SmsService - SMS 발송 (개발 모드): 010-1234-5678 -> [병원 대기 알림] 홍길동님, 곧 진료 차례입니다...
```

### 4.2 실제 SMS 발송 테스트
1. application.yml에 실제 API 키 설정
2. 소량의 테스트 SMS로 발송 확인
3. 로그에서 발송 성공/실패 확인

## 5. 운영 환경 배포 시 주의사항

### 5.1 보안
- API Key와 Secret은 환경변수나 외부 설정 파일로 관리
- 소스코드에 하드코딩 금지
- 프로덕션 환경에서는 별도 설정 파일 사용 권장

### 5.2 요금 관리
- COOLSMS 요금제 확인 및 충전
- 발송량 모니터링
- 일일/월간 발송 한도 설정 고려

### 5.3 모니터링
- SMS 발송 성공/실패 로그 모니터링
- 발송량 추적
- 환자 피드백 수집

## 6. 문제 해결

### 6.1 SMS 발송 실패 시
1. API Key/Secret 확인
2. 발신번호 등록 상태 확인
3. 계정 잔액 확인
4. 수신번호 유효성 확인
5. 로그 확인 후 COOLSMS 고객센터 문의

### 6.2 일반적인 오류
- `401 Unauthorized`: API Key/Secret 오류
- `402 Payment Required`: 잔액 부족
- `403 Forbidden`: 발신번호 미등록
- `429 Too Many Requests`: 발송 한도 초과

## 7. 추가 기능 확장 가능성

### 7.1 MMS 발송
- 병원 안내도, QR코드 등 이미지 포함 메시지
- 처방전 이미지 발송

### 7.2 알림톡 연동
- 카카오 알림톡으로 더 풍부한 정보 제공
- 대기 현황 실시간 업데이트

### 7.3 예약 알림
- 진료 예약 확인 SMS
- 진료 전날 리마인더 SMS

---

**주의**: 실제 운영 환경에서는 개인정보보호법을 준수하여 SMS 발송 동의를 받은 환자에게만 발송해야 합니다. 